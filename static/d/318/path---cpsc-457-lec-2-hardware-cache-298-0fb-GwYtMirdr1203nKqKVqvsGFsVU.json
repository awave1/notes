{"data":{"markdownRemark":{"html":"<h2>Hardware Review</h2>\n<p>A typical computer contains of several components that are interconnected through a bus.</p>\n<h3>CPU</h3>\n<p>CPU is the \"brain\" of the computer. It contains different types of registers (registers - very fast memory):</p>\n<ul>\n<li>\n<p>On-board registers for faster computation.</p>\n<ul>\n<li>Instead of accessing memory for every instruction</li>\n<li>Accessing information in registers is faster than memory</li>\n</ul>\n</li>\n<li>\n<p>General purpose registers</p>\n<ul>\n<li>Data &#x26; address</li>\n</ul>\n</li>\n</ul>\n<!--TODO: Finish-->\n<p>A simple CPU cycle:</p>\n<ol>\n<li><strong>Fetch</strong> an instruction</li>\n<li><strong>Decode</strong> it to determine its type and operands</li>\n<li><strong>Execute</strong> it</li>\n</ol>\n<p>Steps are repeated for the next instruction, until program finishes.</p>\n<p>However, there is a performance issue: fetching from memory takes longer than executing an instruction. A solution would be to <strong>pipeline</strong> the opertaions:</p>\n<h4>CPU Pipelining</h4>\n<ul>\n<li>while executing instruction <code class=\"language-text\">N</code>,</li>\n<li>the CPU could be simultaneously decoding instruction <code class=\"language-text\">N + 1</code>,</li>\n<li>and at the same time also fetch instruction <code class=\"language-text\">N + 2</code></li>\n</ul>\n<p>Therefore fetch-execute cycle can be done in parallel. Parallelized app will be as fast as slowest link of the pipeline. Three stage pipeline:</p>\n<div class=\"remark-draw remark-draw-mermaid\"><svg id=\"mermaid-1551895035006\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" style=\"max-width: 430.40625px;\" viewBox=\"0 0 430.40625 55\"><style>#mermaid-1551895035006 .label{font-family:trebuchet ms,verdana,arial;color:#333}#mermaid-1551895035006 .node circle,#mermaid-1551895035006 .node ellipse,#mermaid-1551895035006 .node polygon,#mermaid-1551895035006 .node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}#mermaid-1551895035006 .node.clickable{cursor:pointer}#mermaid-1551895035006 .arrowheadPath{fill:green}#mermaid-1551895035006 .edgePath .path{stroke:green;stroke-width:1.5px}#mermaid-1551895035006 .edgeLabel{background-color:#e8e8e8}#mermaid-1551895035006 .cluster rect{fill:#cdffb2!important;stroke:#6eaa49!important;stroke-width:1px!important}#mermaid-1551895035006 .cluster text{fill:#333}#mermaid-1551895035006 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:trebuchet ms,verdana,arial;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1551895035006 .actor{stroke:#13540c;fill:#cde498}#mermaid-1551895035006 text.actor{fill:#000;stroke:none}#mermaid-1551895035006 .actor-line{stroke:grey}#mermaid-1551895035006 .messageLine0{marker-end:\"url(#arrowhead)\"}#mermaid-1551895035006 .messageLine0,#mermaid-1551895035006 .messageLine1{stroke-width:1.5;stroke-dasharray:\"2 2\";stroke:#333}#mermaid-1551895035006 #arrowhead{fill:#333}#mermaid-1551895035006 #crosshead path{fill:#333!important;stroke:#333!important}#mermaid-1551895035006 .messageText{fill:#333;stroke:none}#mermaid-1551895035006 .labelBox{stroke:#326932;fill:#cde498}#mermaid-1551895035006 .labelText,#mermaid-1551895035006 .loopText{fill:#000;stroke:none}#mermaid-1551895035006 .loopLine{stroke-width:2;stroke-dasharray:\"2 2\";marker-end:\"url(#arrowhead)\";stroke:#326932}#mermaid-1551895035006 .note{stroke:#6eaa49;fill:#fff5ad}#mermaid-1551895035006 .noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}#mermaid-1551895035006 .section{stroke:none;opacity:.2}#mermaid-1551895035006 .section0,#mermaid-1551895035006 .section2{fill:#6eaa49}#mermaid-1551895035006 .section1,#mermaid-1551895035006 .section3{fill:#fff;opacity:.2}#mermaid-1551895035006 .sectionTitle0,#mermaid-1551895035006 .sectionTitle1,#mermaid-1551895035006 .sectionTitle2,#mermaid-1551895035006 .sectionTitle3{fill:#333}#mermaid-1551895035006 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px}#mermaid-1551895035006 .grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}#mermaid-1551895035006 .grid path{stroke-width:0}#mermaid-1551895035006 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1551895035006 .task{stroke-width:2}#mermaid-1551895035006 .taskText{text-anchor:middle;font-size:11px}#mermaid-1551895035006 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}#mermaid-1551895035006 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1551895035006 .taskText0,#mermaid-1551895035006 .taskText1,#mermaid-1551895035006 .taskText2,#mermaid-1551895035006 .taskText3{fill:#fff}#mermaid-1551895035006 .task0,#mermaid-1551895035006 .task1,#mermaid-1551895035006 .task2,#mermaid-1551895035006 .task3{fill:#487e3a;stroke:#13540c}#mermaid-1551895035006 .taskTextOutside0,#mermaid-1551895035006 .taskTextOutside1,#mermaid-1551895035006 .taskTextOutside2,#mermaid-1551895035006 .taskTextOutside3{fill:#000}#mermaid-1551895035006 .active0,#mermaid-1551895035006 .active1,#mermaid-1551895035006 .active2,#mermaid-1551895035006 .active3{fill:#cde498;stroke:#13540c}#mermaid-1551895035006 .activeText0,#mermaid-1551895035006 .activeText1,#mermaid-1551895035006 .activeText2,#mermaid-1551895035006 .activeText3{fill:#000!important}#mermaid-1551895035006 .done0,#mermaid-1551895035006 .done1,#mermaid-1551895035006 .done2,#mermaid-1551895035006 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1551895035006 .doneText0,#mermaid-1551895035006 .doneText1,#mermaid-1551895035006 .doneText2,#mermaid-1551895035006 .doneText3{fill:#000!important}#mermaid-1551895035006 .crit0,#mermaid-1551895035006 .crit1,#mermaid-1551895035006 .crit2,#mermaid-1551895035006 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1551895035006 .activeCrit0,#mermaid-1551895035006 .activeCrit1,#mermaid-1551895035006 .activeCrit2,#mermaid-1551895035006 .activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}#mermaid-1551895035006 .doneCrit0,#mermaid-1551895035006 .doneCrit1,#mermaid-1551895035006 .doneCrit2,#mermaid-1551895035006 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1551895035006 .activeCritText0,#mermaid-1551895035006 .activeCritText1,#mermaid-1551895035006 .activeCritText2,#mermaid-1551895035006 .activeCritText3,#mermaid-1551895035006 .doneCritText0,#mermaid-1551895035006 .doneCritText1,#mermaid-1551895035006 .doneCritText2,#mermaid-1551895035006 .doneCritText3{fill:#000!important}#mermaid-1551895035006 .titleText{text-anchor:middle;font-size:18px;fill:#000}#mermaid-1551895035006 g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}#mermaid-1551895035006 g.classGroup rect{fill:#cde498;stroke:#13540c}#mermaid-1551895035006 g.classGroup line{stroke:#13540c;stroke-width:1}#mermaid-1551895035006 .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}#mermaid-1551895035006 .classLabel .label{fill:#13540c;font-size:10px}#mermaid-1551895035006 .relation{stroke:#13540c;stroke-width:1;fill:none}#mermaid-1551895035006 #compositionEnd,#mermaid-1551895035006 #compositionStart{fill:#13540c;stroke:#13540c;stroke-width:1}#mermaid-1551895035006 #aggregationEnd,#mermaid-1551895035006 #aggregationStart{fill:#cde498;stroke:#13540c;stroke-width:1}#mermaid-1551895035006 #dependencyEnd,#mermaid-1551895035006 #dependencyStart,#mermaid-1551895035006 #extensionEnd,#mermaid-1551895035006 #extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}#mermaid-1551895035006 .branch-label,#mermaid-1551895035006 .commit-id,#mermaid-1551895035006 .commit-msg{fill:#d3d3d3;color:#d3d3d3}</style><style>#mermaid-1551895035006 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"Times New Roman\";\n  }</style><g transform=\"translate(-12, -12)\"><g class=\"output\"><g class=\"clusters\"></g><g class=\"edgePaths\"><g class=\"edgePath\" style=\"opacity: 1;\"><path class=\"path\" d=\"M114.984375,39.5L139.984375,39.5L164.984375,39.5\" marker-end=\"url(#arrowhead12)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead12\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath\" style=\"opacity: 1;\"><path class=\"path\" d=\"M272.515625,39.5L297.515625,39.5L322.515625,39.5\" marker-end=\"url(#arrowhead13)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead13\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"node\" id=\"A\" transform=\"translate(67.4921875,39.5)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-47.4921875\" y=\"-19.5\" width=\"94.984375\" height=\"39\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-37.4921875,-9.5)\"><foreignObject width=\"74.984375\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Fetch Unit</div></foreignObject></g></g></g><g class=\"node\" id=\"B\" transform=\"translate(218.75,39.5)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-53.765625\" y=\"-19.5\" width=\"107.53125\" height=\"39\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-43.765625,-9.5)\"><foreignObject width=\"87.53125\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Decode Unit</div></foreignObject></g></g></g><g class=\"node\" id=\"C\" transform=\"translate(378.4609375,39.5)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-55.9453125\" y=\"-19.5\" width=\"111.890625\" height=\"39\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-45.9453125,-9.5)\"><foreignObject width=\"91.890625\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Execute Unit</div></foreignObject></g></g></g></g></g></g></svg></div>\n<p>Pros:</p>\n<ul>\n<li>the CPU can execute more than one instruction at a time</li>\n<li>'hide' the memory access time</li>\n</ul>\n<p>Cons:</p>\n<ul>\n<li>more complexity</li>\n</ul>\n<h3>Memory</h3>\n<p>Ideally, memory should be (i) fast, (ii) large and (iii) cheap. In practice, we can get 2 out of 3, but not all three.</p>\n<p>Main memory is RAM (Random Access Memory). Memory is a accessible big array of bytes. Memory operations:</p>\n<ul>\n<li><strong>load</strong>: moves a word from memory to a CPU register</li>\n<li><strong>store</strong>: moves a content of a register to memory</li>\n</ul>\n<p>Both load and store operations are slow compared to the speed of CPU.</p>\n<h2>Caching</h2>\n<p>CPU caching is the process of most heavily used data from memory is kept in a high-speed cache inside or very close to the CPU. When CPU needs to get data from memory, it first checks the cache:</p>\n<ul>\n<li>\n<p><strong>cache hit</strong>: the data needed by the CPU is in the cache</p>\n  <!--or-->\n</li>\n<li><strong>cache miss</strong>: CPU needs to fetch the data from main memory</li>\n</ul>\n<p>CPU consists of multiple levels of caches:</p>\n<ul>\n<li>L1 cache (16kB): inside the CPU, usually feeds decoded instructions into CPU execution engine</li>\n<li>L2 cache (xMB): stores recently used memory words, slower than L1</li>\n<li>L3 and L4 are becoming common</li>\n</ul>\n<!--core is like a mini cpu-->\n<h3>Caching on multicore CPUs</h3>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d3db85953807fa906d525e8102cdec6/984da/lec2-caching1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.06611570247933%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACTklEQVQoz0WSX2vTUBjG9x0EP4F3foSBn8KhTK8G3rgbvfLCSy8cc45dDhQGIkMmCOIfnJSNucm2dl3pX9suSZOepEnTpE33B9uuzc+TZMND3veccB6e877P804hVyBU3C8fafstLEfB+7yBYyr45350TTiZxHu/qeK9f4tTL2Ne+Ljb3/E/fcDybbx+J8ZMhTKZ5TSNlWV0o0GlkcF4vYSSz2F4OmEoya4IW+kd3Nl79A72sAkwll/gzc8TnHYwXVViQ6ZkxuzJys66+J6F7pVx/wZYtqDpNggJScoMsQMH0evy47dKKlvDOrWpCpeNzSp5VY1AskKJt7oaqcwu3zLHpIo5vu4fsl04oNlV4ldjUvmZnpCt2cytVLj/6hDvVKOgOdx+nObdVilpeTIGf2DwYLXAzYfHTD8rceNRjadrafyLOuMxMWm0zHadP/lNylKWcrtE/WSPWnGLvJlDaVcTwihZeoHM+iqZeo6cekR2/Q2Z/C8MWXlc4ZWG9u5Punem6e/tIDhHPH9Cf2aG7lkP0VbjTmJTWsU09tIijm2iNrO4iy+lUSWELxJTwlgeHN9CaCrFokJN6IiWglZVKFR0GrZ+rWEotTI58V00Q6PSKqAGPoquoTtXGoaJhqLTpCNJZxfy3F04kHqqHFdNbs3ts5Yq/m85kPPmeAbtoEWr15TzKHB6pmwlma1rp/sXPeyuIKs2OVJ1iRfSKIudsobhugnhaDRiOBgmMYzOMoZDBoOBjGSfSA3H0p3oHOGYXMJ4FN9HWCYjLkfD+P8f3PTSSGXsKawAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Caching on multicore CPUs\"\n        title=\"\"\n        src=\"/static/4d3db85953807fa906d525e8102cdec6/623ee/lec2-caching1.png\"\n        srcset=\"/static/4d3db85953807fa906d525e8102cdec6/816c5/lec2-caching1.png 148w,\n/static/4d3db85953807fa906d525e8102cdec6/c766b/lec2-caching1.png 295w,\n/static/4d3db85953807fa906d525e8102cdec6/623ee/lec2-caching1.png 590w,\n/static/4d3db85953807fa906d525e8102cdec6/e5345/lec2-caching1.png 885w,\n/static/4d3db85953807fa906d525e8102cdec6/7a439/lec2-caching1.png 1180w,\n/static/4d3db85953807fa906d525e8102cdec6/84fe0/lec2-caching1.png 1770w,\n/static/4d3db85953807fa906d525e8102cdec6/984da/lec2-caching1.png 2178w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<!--1. can process bigger chunks, bigger parts of the memory because L2 will be bigger-->\n<p>Caches can be shared and there are multiple ways of sharing cache.</p>\n<hr>\n<p>The goal of caching is to increase performance of slower memory/device by adding a small amount of fast memory (cache). Ways of improving read performance:</p>\n<ul>\n<li>keep copy of information obtained from slow storage in cache</li>\n<li>check cache on next read</li>\n</ul>\n<p>Improving write performance:</p>\n<ul>\n<li>write info to fast storage, and eventually write to slow storage</li>\n</ul>\n<p>Caching is a very useful concept. There are many uses: disk cache, DNS, databases.</p>\n<p>Cache storage is fast but expensive, so it's usually much smaller than the slow storage. Some general caching issues:</p>\n<ul>\n<li>when to put a new item into the cache</li>\n<li>which cache line to put the new item in</li>\n<li>which item to remove from the cache when it's full</li>\n<li>where to put a newly evicted item in the larger memory</li>\n<li>multiple cache synchronization</li>\n<li>how long is the data in cache valid</li>\n</ul>\n<h3>Memoization</h3>\n<p>It's a similar concept to caching. It can be used to speed up function that are slow to compute. Optimization technique used to speed up programs, by storing results of expensive computations.</p>\n<p>Unoptimized function:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">fib_slow</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> n\n  <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> fib_slow<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fib_slow<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Optimized function:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cache <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">fib_fast</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> n <span class=\"token operator\">not</span> <span class=\"token keyword\">in</span> cache<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n      cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> n\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n      cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> fib_fast<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fib_fast<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Hardware I/O</h2>\n<p>I/O devices usually implemented in two parts: device controller and the device.</p>\n<p>A <strong>device controller</strong> is a chip or a set of chips that physically control the device. Controlling the device is complicated, and CPU could be doing other things, so the controller presents a simpler interface to the OS. A controller presents a unified interface of devices that it can support to the OS.</p>\n<p>A <strong>device</strong> connects to the computer through the controller. It follows some agreed standards for communication.</p>\n<p>A <strong>device driver</strong> is the software abstraction of the controller, the software that talks to a controller, issues commands and accepts responses. Usually is written by the manufacturer. Driver is needed so the OS knows how to communicate with the device.</p>\n<h2>Buses</h2>\n<p><strong>Bus</strong> is a communication system for transferring data between different computer components.</p>\n<h2>Booting Process</h2>\n<p>When the computer is booted, the BIOS is started. BIOS (Basic Input Output Program) is a program stored on motherboard.</p>\n<h2>Kernel</h2>\n<p>The central part, or the heart of the OS. Kernel is running at all times on the computer. It is located and started by a bootstrap program (bootloader). Kernel provides services to applications via system calls and handles all interrupts. Much of kernel is a set of routines, some invoked in response to interrupts, others because of application using system calls, etc.</p>\n<h3>Kernel mode</h3>\n<p>Most modern CPUs support at least two privilege levels: <strong>kernel mode</strong> and <strong>user mode</strong>. The mode is usually controlled by modifying the status register. On CPUs without this support, there's only kernel mode.</p>\n<p>When CPU is in <strong>kernel mode</strong>:</p>\n<ul>\n<li>all instructions are allowed</li>\n<li>all I/O operations are allowed</li>\n<li>all memory can be accessed</li>\n</ul>\n<!--not all kernel runs in kernel mode-->\n<p>When CPU is in kernel mode, every instruction are executed.</p>\n<h3>User mode</h3>\n<p>When OS runs a normal application, it runs it in a <strong>user mode</strong>. Only a subset of operations are allowed (e.g. accessing the status register is not allowed). I/O instructions are not allowed, access to some parts of memory is not allowed. Illegal instructions result in traps (exceptions).</p>\n<p>Applications that run in user mode must ask kernel to do I/O. Therefore, applications must invoke a <strong>system call</strong>, which is usually accomplished by invoking a <strong>trap</strong> into the OS.</p>\n<h4>Trap</h4>\n<p>Trap is a special asm instruction (<code class=\"language-text\">SWI n</code>, <code class=\"language-text\">INT n</code>, <code class=\"language-text\">TRAP n</code>). Trap switches from user mode to kernel mode and invokes a <strong>predefined routine</strong>. It 'pauses' the application to execute kernel routine configured by the OS. When kernel routine is done, user mode is restored and application 'resumes'.</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8d89be046658dcbe0acd354f8bfd4e04/66a22/lec2-kernel-user-mode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.998240985048376%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMElEQVQoz3VSh4qEMBD1//9OBJW1xAaWGPuJfc43Rw6Xuw0Ew2Ty2mhM00RSSsK3bVtSSvG5rmtqmobO86TruniP48i1ZVkIS9efyyjLkkzTZNDX60WWZTGY4zgUhiEdx/ELmuc5+b7PwE/A5za2baNhGLhhXVfq+57P+OIOTRoQyqD+ExgDQo3rumxFCMGqYBs1KAJZ13VMEAQBRVFE8zz/sfpmGTaSJCHP8/hBmqYUx/HbF/kCFMQgAakQIWVZdtcUqVreDhcydBMakKMeDBqLouAz7kGs736Go243/k0W35lLzpota+/7vvMDPIYiDAVDwhk1RKMfIVMQIB6orKryjuGL64b2jkZkgw11mDxyhEpdfy4ojETACqWsGBCExn//EtTYts0bqp+kn4ah1zdeUK/0/+Z77gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Kernel mode vs User mode\"\n        title=\"\"\n        src=\"/static/8d89be046658dcbe0acd354f8bfd4e04/623ee/lec2-kernel-user-mode.png\"\n        srcset=\"/static/8d89be046658dcbe0acd354f8bfd4e04/816c5/lec2-kernel-user-mode.png 148w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/c766b/lec2-kernel-user-mode.png 295w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/623ee/lec2-kernel-user-mode.png 590w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/e5345/lec2-kernel-user-mode.png 885w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/7a439/lec2-kernel-user-mode.png 1180w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/84fe0/lec2-kernel-user-mode.png 1770w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/66a22/lec2-kernel-user-mode.png 2274w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<!--true-->\n<!--true-->\n<!--most run in kernel, but some are in user mode-->","frontmatter":{"date":"January 17, 2019","title":"Hardware, Cache, Booting, Kernel","tags":["cpsc457"]}}},"pageContext":{"prev":{"fields":{"slug":"/cpsc457/lec1-basic-concepts"},"frontmatter":{"published":true,"tags":["cpsc457"]}},"slug":"/cpsc457/lec2-hardware-cache","next":{"fields":{"slug":"/cpsc441/lec2-application-layer"},"frontmatter":{"published":true,"tags":["cpsc441"]}},"category":"cpsc457"}}