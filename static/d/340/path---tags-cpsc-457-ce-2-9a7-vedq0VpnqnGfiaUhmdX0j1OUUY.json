{"data":{"allMarkdownRemark":{"totalCount":9,"edges":[{"node":{"id":"d3a14bce-c8c4-51bc-abca-a763950d7dcc","html":"<h2>'Dining Philosophers' Problem</h2>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e245f682dd85636724ea918eae956471/efba4/lec9-dining-philosophers.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 105.3968253968254%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAD70lEQVQ4y5WU+0/TVxjG+zfshy3+ssEPJEtMDNvYiIHh5uzEKLWAuHJzDY6bXDJLi8SUwmADZ3SgDKjcAuU+IiCGNWwDFpBxlzKlOJCJDBSIjMvsHNDyWVtoFSpL9ibne3Le73mf87znPO8r4CW2sbFhHRYzGAxotVru3bvn8O9lJtjth9FotM79/f14enpSXl5uXZtMpv8PaAmwBFpsfHwcV1dXK0vbQf/FUrAzDdtsNK5vMhwYRJWahm747pZ/zWHvi/ECCxOTyWgd9g0m43O2689Ymptk4fHv27PYysCWjY25Q8o2sKX5Kfobz3NN6c3Z+ATOxUfRnOPPnXY16+vGrfs0OqY8NTVBSMCH5H97we58ONKORvk2NUmvESzyoLA0A1VGGinSvdxMeQVt3kmW/5yzg2o0GkpKSjYZJsnDCD28B6HHHn4bH+Pp3Ci1qn00Zb5FXsI+VNHHEEtiiY46Q3XaB5Qq3ahXvU63JsQKeKOpCRcXF7y8vOjs7EQQHHiMvW++wTuur9Lb00pNThKxn4XypSwI7eX36cg7SGW6iKZLR7mtEaNReZEpD+F8hA8zI60UFpfi7OyEj4/IKi1BQYEagUCAm/u7PNB3c0LsR21DFnEKpTn4EHdr/BiuFDNU4cv965+QEvkxX2QqSbuQQu7FdHq7O3Bycsbd3Z2urq7NR/m+uYmJyRmejLdyJtCb4DAZsrhoWq6KGTSz6i/zZ7AikJFKEdkKMQGhccQnyMhNCWPdMMdPbT+bC6DPUdgTA420XPYiPUpIXaaIoXI/bl07yq/ffYquKogBTSCj18MoTA0l++wR+sz3aFia21YQAstnfW3V6nh8v5fGjP1UpHrQmiNkoPS4Od0TVnbD1cGMVAVwu8yXG5eEdOYf4U6jnH/+NmAyY2zToU3Qz56u0KYO4Mfsg6TLpCTERFJ/0Rd9XRDDVRJylSHIYqLIkov4IesjRtty7dq1V8pm2TwX9LSuDqXUjc/PySitzSdGKqGvSEh1ujdBp6TUNxcSHnaaW+rjLD/5YytV03ZAWxexWUv1FbwP+3M6Op5vEk+iSd5PfcYBJAGnkEbEkhgp4ZG+3QHM/ig2ML1eT3Kyiubmm3S1NJCTKEb7tRsNX71H+xVP6tIOcFUVzdjwLywu/8XMzLQ9dhtDm1OhUBARHo5EYmYwO2v2rDE91sPEYCOTwy0sPtJvquHBQyrMIi4rK2NhYcER0LaQyxVERkbi6+uLTqfbtYn29vRQXFxMQUEBs9aDd2HY0dGBUCg0A8tZXV21F7+1tW3NFrOwUqvVFBUV2Tu7HfDFhcWGhoZYXFx0eKidTXV+fp6VlRV2xv8LMhBwjOSZc78AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Philosophers\"\n        title=\"\"\n        src=\"/static/e245f682dd85636724ea918eae956471/fb8a0/lec9-dining-philosophers.png\"\n        srcset=\"/static/e245f682dd85636724ea918eae956471/1a291/lec9-dining-philosophers.png 148w,\n/static/e245f682dd85636724ea918eae956471/2bc4a/lec9-dining-philosophers.png 295w,\n/static/e245f682dd85636724ea918eae956471/fb8a0/lec9-dining-philosophers.png 590w,\n/static/e245f682dd85636724ea918eae956471/efba4/lec9-dining-philosophers.png 630w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>There are 5 philosophers sitting around a table. Philosophers want to do 2 things, forever:</p>\n<ul>\n<li>eat, and then</li>\n<li>think</li>\n</ul>\n<p>There are 5 bowls of food, one for each philosophers &#x26; 5 forks placed between bowls. Before eating, a philosopher must grab two forks, immediately to the left &#x26; right. Philosopher then eats for a short time. When done eating, the philosopher puts down the forks in their original positions. Philosopher then thinks for a short time.</p>\n<p><strong>Software scenario</strong>:</p>\n<ul>\n<li>5 processes/threads, each needs exclusive access to two resources to proceed.</li>\n</ul>\n<p>How to allocate resources so that all processes/threads get to execute? What is the <strong>best</strong> algorithm for threads/processes to follow?</p>\n<p>Assuming each philosopher eats &#x26; thinks for the exact same amount of time, optimal schedule:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">repeat:\n  1 &amp; 3 eat\n  2 &amp; 4 eat\n  3 &amp; 5 eat\n  4 &amp; 1 eat\n  5 &amp; 2 eat</code></pre></div>\n<blockquote>\n<p>There is no solution for every case.</p>\n</blockquote>\n<hr>\n<p><strong>Attempt 1</strong>:</p>\n<p>Assuming that philosophers are \"perfectly synchronized\". Each philosopher follows these steps:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">repeat forever:\n  grab left fork\n  grab right fork\n  eat\n  put forks back\n  think</code></pre></div>\n<p>This would lead to a <mark><strong>deadlock</strong></mark>:</p>\n<ul>\n<li>assuming all philosophers are reasonably synchronized</li>\n<li>each philosopher will end up grabbing the left fork</li>\n<li>each philosopher will be stuck trying to grab the right fork</li>\n<li>nobody gets to eat at all</li>\n</ul>\n<p><strong>Attempt 2</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">repeat forever:\n  repeat:\n    try to grab left fork\n    try to grab right fork\n    if both forks grabbed:\n      break\n    else:\n      put any grabbed forks back and take a short nap\n  eat\n  put forks back\n  think</code></pre></div>\n<p>This would reach <mark><strong>livelock</strong></mark>:</p>\n<ul>\n<li>assuming they are all synchronized</li>\n<li>all philosophers will indefinitely switch switch between napping and attempting to eat</li>\n<li>nobody will eat - form of <strong>starvation</strong></li>\n</ul>\n<p><strong>Attempt 3</strong>:</p>\n<p>Same as before, but there is one pink hat that one philosopher is wearing</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">repeat forever:\n  wait for hat\n  grab forks, eat, put forks back\n  give hat to someone else\n  think</code></pre></div>\n<p>It would work, but:</p>\n<ul>\n<li>only one process get to eat</li>\n<li>but with 5 forks, 2 philosophers could be eating at the same time</li>\n<li>it defeats the purpose of multithreading (no parallelism of eating); not optimal use of resources</li>\n<li>called arbitrator solution</li>\n</ul>\n<p><strong>Attempt 4</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">while true:\n  repeat\n    try to grab left fork\n    try to grab right fork\n    if both forks grabbed:\n      break\n    else:\n      put any grabbed forks back\n      take a short **RANDOM** nap\n  eat\n  put forks back\n  think</code></pre></div>\n<p>We introduce a random <strong>timeout</strong> mechanism for preventing deadlocks. Likely to work, often used in real world, for example in networking. However, there is still a small chance for starvation:</p>\n<ul>\n<li>if sleep is the same for all philosophers, then no one gets to eat</li>\n<li>in some cases some philosophers might never get to eat, or some philosophers will get to eat less often than the others - <em>fairness problem</em></li>\n</ul>\n<p><strong>Attempt 5</strong>:</p>\n<ul>\n<li>Label the forks with numbers: 1, ..., 5</li>\n<li>\n<p>Each philosopher:</p>\n<ul>\n<li>picks up the fork with the smallest number first, then the larger number second</li>\n<li>if unable to pick up both forks, put a claimed fork down and take a short nap</li>\n</ul>\n</li>\n</ul>\n<p>This is a <strong>resource hierarchy</strong> solution - by establishing a <strong>partial order</strong> on resources. Starvation is still possible. Also not always practical for large/dynamic number of resources.</p>\n<hr>\n<p><strong>Naive algorithm implementation</strong>:</p>\n<p>Even trying to implement a naive solution presents problems. Consider algorithm for #1:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* \n  Utencil state: \n    true = available\n    false = unavailable\n*/</span>\nbool forks<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                          <span class=\"token comment\">// think for s seconds</span>\n  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// i + 1 % 5 arithmetic</span>\n  forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n  forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span>\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                          <span class=\"token comment\">// eat for m seconds</span>\n  forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n  forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Depending on the execution order (e.g. multicore machines, or timing of context switches):</p>\n<ul>\n<li>both philosophers could start eating at the same time</li>\n<li>i.e. both processes could enter the critical region</li>\n</ul>\n<p>In that code, the shared resource is the global variable <code class=\"language-text\">forks[]</code>. The critical sections are:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* \n  Utencil state: \n    true = available\n    false = unavailable\n*/</span>\nbool forks<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// critical section</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span></span>  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>                          <span class=\"token comment\">// critical section</span>\n<span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<hr>\n<h2>Mutex (aka Lock)</h2>\n<p><strong>Mutex</strong> is a synchronization mechanism used for ensuring <strong>exclusive access</strong> to a resource in concurrent programs. Think of mutex as a special boolean type that can represent a lock:</p>\n<ul>\n<li><code class=\"language-text\">true</code> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> locked</li>\n<li><code class=\"language-text\">false</code> <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> unlocked</li>\n</ul>\n<p>We can set it to <code class=\"language-text\">true</code> or <code class=\"language-text\">false</code> just like a regular boolean variable. But, if the lock is already locked, and some thread tries to also lock it, then the calling thread will be automatically suspended until whoever locked the lock, unlocks it.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">mutex lock<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Will block if already TRUE</span>\nlock <span class=\"token operator\">=</span> TRUE<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/*\n Critical section\n\n it is protected by the mutex lock\n*/</span>\n\n<span class=\"token comment\">// May unblock some other thread</span>\nlock <span class=\"token operator\">=</span> FALSE<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Mutex is often implemented as an object with two possible states: <em>locked</em> and <em>unlocked</em>. It implements two operations <code class=\"language-text\">lock()</code> and <code class=\"language-text\">unlock()</code>. If multiple threads call <code class=\"language-text\">lock()</code> simultaneously, only one will proceed, the others will block. Therefore, only the thread <em>that locks</em> the mutes can <em>unlock it</em>.</p>\n<p>A waiting queue is used to keep track of all threads waiting on the mutex to be unlocked. Once the mutex is unlocked, one of the blocked threads will be unlocked. <em>Note</em>: which one thread gets unlocked is usually not predictable. It can be implemented in software via busy waiting, but usually supported by hardware + OS. Portable libraries often try to use H/W mutex but are able to fall back to software.</p>\n<h3>Mutex in pthread</h3>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">pthread_mutex_init()</code></td>\n<td>create a mutex</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">pthread_mutex_destroy()</code></td>\n<td>destroy a mutex</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">pthread_mutex_lock()</code></td>\n<td>lock a mutex, block if already locked</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">pthread_mutex_trylock()</code></td>\n<td>lock a mutex, or fail (non-blocking version)</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">pthread_mutex_unlock()</code></td>\n<td>unlock a mutex</td>\n</tr>\n</tbody>\n</table>\n<p><strong>Counter with mutex</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;pthread.h></span></span>\n\n<span class=\"token comment\">// initialized in main() with pthread_mutex_init()</span>\npthread_mutex_t count_mutex<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// initialized in main() with counter = 0</span>\n<span class=\"token keyword\">int</span> counter<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// acquire the lock</span>\n  <span class=\"token function\">pthread_mutex_lock</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>count_mutex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> counter<span class=\"token punctuation\">;</span>\n  x<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  counter <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// release the lock</span>\n  <span class=\"token function\">pthread_mutex_unlock</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>count_mutex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Dining philosopher with mutex</strong>:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre style=\"counter-reset: linenumber 0\" class=\"language-c line-numbers\"><code class=\"language-c\">pthread_mutex_t mutex<span class=\"token punctuation\">;</span>\nbool forks<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>true<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">pthread_mutex_lock</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>mutex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> false<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">pthread_mutex_unlock</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>mutex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n  <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">pthread_mutex_lock</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>mutex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  forks<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> true<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">pthread_mutex_unlock</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>mutex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>However, this will not work, due to <strong>deadlock</strong>. <code class=\"language-text\">while (!forks[i] || forks[i + 1]);</code> will result in an infinite loop. It can also be argued that this is a <strong>livelock</strong>.</p>\n<hr>\n<h2>Summary</h2>\n<ul>\n<li><strong>Critical section</strong> - part of the program where a shared resource is accessed &#x26; may cause trouble</li>\n<li><strong>Mutual exclusion</strong> - ensuring only one process accesses a resource at a time, e.g. only one process can enter critical section at a time</li>\n<li><strong>Mutex/lock</strong> - mechanism to achieve mutual exclusion, two states + queue</li>\n<li><strong>Deadlock</strong> - a state where each process/thread is waiting on another to release a lock <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> no progress is made</li>\n<li><strong>Livelock</strong> - states of the process change, but none are progressing</li>\n<li><strong>Starvation</strong> - one process does not get to run at all</li>\n<li><strong>Unfairness</strong> - not all processes get equal opportunity to progress</li>\n<li>\n<p>There are some thread issues:</p>\n<ul>\n<li><code class=\"language-text\">fork()</code>, cancellation, signals, thread pool</li>\n<li>race conditions</li>\n<li>critical section, mutual exclusion</li>\n<li>dining philosophers problem</li>\n<li>mutex</li>\n<li>deadlock, livelock, starvation, fairness</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Dining Philosophers, Locks, Mutexes","date":"2019-02-12","description":""},"fields":{"slug":"/cpsc457/lec9-mutexes-locks-dining-philosophers","category":"cpsc457"}}},{"node":{"id":"b36b0d1c-f6b2-519a-b89f-b1aaf59a0d31","html":"<h2>Threads and <code class=\"language-text\">fork()</code></h2>\n<p>When <code class=\"language-text\">fork()</code> is called in a program with multiple threads. What happens is only the calling thread survives, other threads are not duplicated. This creates a problem if synchronization mechanisms used. It's possible to register a callback in case <code class=\"language-text\">fork()</code> is called using <code class=\"language-text\">pthread_atfork()</code>. However, generally <strong><code class=\"language-text\">fork()</code> should be avoided</strong> in programs with multiple threads.</p>\n<p>Some usages are sage: e.g.:</p>\n<ul>\n<li><code class=\"language-text\">fork()</code> is immediately followed by <code class=\"language-text\">execve()</code> to execute external program</li>\n<li><code class=\"language-text\">fork()</code> is executed before creating any threads</li>\n</ul>\n<h2>Thread cancellation</h2>\n<p>Imagine a scenario when threads are used to parallelize database search. Multiple threads are searching different parts of the database. If one thread finds the result, how do we notify the other threads to stop searching?</p>\n<p>There are two general approaches:</p>\n<ul>\n<li>Asynchronous cancellation</li>\n<li>Deferred cancellation (aka synchronous cancellation)</li>\n</ul>\n<h3>Async cancellation</h3>\n<!--async becuse there is no sync with thread that needs to be cancelled, as soon as the signal is received (so data might be missing)-->\n<p>One thread manually terminates the target thread using <code class=\"language-text\">pthread_kill(thread_id, SIGUSR1)</code> and then target is killed instantly.</p>\n<p>Common problem is what happens to the data currently updated by the thread that is killed?</p>\n<ul>\n<li>Killed thread has no chance to clean up</li>\n<li>This can likely lead to leaving data in undefined state</li>\n</ul>\n<p>Usually, it is better to use synchronous thread cancellation.</p>\n<h3>Deferred / Synchronous Thread Cancellation</h3>\n<!-- TODO: Finish -->\n<h2>Race Conditions</h2>\n<p>Race condition is a behavior where the output is dependent on the sequence of timing or other uncontrollable events (e.g. context switching, scheduling on multiple CPUs). Often a result of multiple processes/threads operating on a shared state/resource, e.g.:</p>\n<ul>\n<li>modifying shared memory</li>\n<li>reading/writing to files</li>\n<li>modifying filesystems</li>\n<li>reading/writing to databases</li>\n</ul>\n<p>Let's take the following code for example</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">// Global variable counter</span>\n<span class=\"token keyword\">int</span> counter<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// This function is assumes that this is atomic (not interfered by anyone else)</span>\n  <span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> counter<span class=\"token punctuation\">;</span>\n  x<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  counter <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> incr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pthread_create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> incr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pthread_join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\\n\"</span><span class=\"token punctuation\">,</span> counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>One possible <strong>execution sequence</strong>, leading to <code class=\"language-text\">counter = 2</code></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"><strong>Thread 1</strong></th>\n<th align=\"center\"><strong>Thread 2</strong></th>\n<th align=\"center\"><strong><code class=\"language-text\">counter</code></strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code class=\"language-text\">x = counter;</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code class=\"language-text\">x++;</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code class=\"language-text\">counter = x;</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">1</code></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">x = counter;</code></td>\n<td align=\"center\"><code class=\"language-text\">1</code></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">x++;</code></td>\n<td align=\"center\"><code class=\"language-text\">1</code></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">counter = x;</code></td>\n<td align=\"center\"><code class=\"language-text\">2</code></td>\n</tr>\n</tbody>\n</table>\n<p>Another possible execution sequence leading to <code class=\"language-text\">counter = 1</code></p>\n<table>\n<thead>\n<tr>\n<th align=\"center\"><strong>Thread 1</strong></th>\n<th align=\"center\"><strong>Thread 2</strong></th>\n<th align=\"center\"><strong><code class=\"language-text\">counter</code></strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code class=\"language-text\">x = counter;</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">x = counter;</code></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">x++;</code></td>\n<td align=\"center\"><code class=\"language-text\">0</code></td>\n</tr>\n<tr>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">counter = x;</code></td>\n<td align=\"center\"><code class=\"language-text\">1</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code class=\"language-text\">x++;</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">1</code></td>\n</tr>\n<tr>\n<td align=\"center\"><code class=\"language-text\">counter = x;</code></td>\n<td align=\"center\"></td>\n<td align=\"center\"><code class=\"language-text\">1</code></td>\n</tr>\n</tbody>\n</table>\n<p>Debugging race conditions is hard, in some rare situations the output might be different, e.g. when system was less/more busy.</p>\n<h3>Avoiding Race Conditions</h3>\n<p>We need to prevent more than one process/thread from accessing the shared resource at any given time. One approach is:</p>\n<ul>\n<li>identify <strong>critical sections</strong> in code where this could happen</li>\n<li>enforce <strong>mutual exclusion</strong> to make sure it does not happen</li>\n</ul>\n<h4>Critical Sections and Mutual Exclusion</h4>\n<p><mark>Critical section/critical region</mark> is a part of the program that accesses the shared resource in a way that could lead to races or other undefined/unpredictable/unwanted behavior:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> counter<span class=\"token punctuation\">;</span> <span class=\"token comment\">// shared resource</span>\n\n<span class=\"token comment\">/**\n * Critical section\n */</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">incr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> counter<span class=\"token punctuation\">;</span>\n  x<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  counter <span class=\"token operator\">=</span> x<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If we can arrange tasks such that no two processes or threads will ever be in their critical sections at the same time, we could avoid the race condition, therefore achieving <mark>mutual exclusion</mark>.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/50265a3714c3e5a9886f001256433e03/50784/lec8-critical-sections-mutual-exclusion.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.54794520547945%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABQElEQVQoz4VSCW6DMBDk/18EKYEKGsA24TCXga1nEqeoStSVVoY9Z8aOjuOQvw5b11XmeaZP0yTbtjHunGNsWRaej/hvXyRvbN93ae936bqObkzDGKwxhv93n1e14uBgGBphe9u2TFhrieYry6QovkUpLXVd06uqkizNpPcLiHocWTv6c+h7xogQ1IACVAAfSLhdKbndbqK1Zh4x49EFagCAgS+pngzeUsaSJwk/rJXL5epRKi4jUs9gGAb+F0UhV59fV/d5YNAFNLRWksSJNE0jvadmtCFaDIRUiOHfucelRdCtLEuxXgvoYQfLZsRBGd/hRuM49mgvkue5JElCdMih76UhYEM/nMFRAD1RBMHTNOXFIA45UA/9MAz1Qft/NcSJwvPbDIYhGHw2PptPDzu8x4delrfeec1C43nIue8HW80KzcPk0a4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Critical Sections and Mutual Exclusion\"\n        title=\"\"\n        src=\"/static/50265a3714c3e5a9886f001256433e03/fb8a0/lec8-critical-sections-mutual-exclusion.png\"\n        srcset=\"/static/50265a3714c3e5a9886f001256433e03/1a291/lec8-critical-sections-mutual-exclusion.png 148w,\n/static/50265a3714c3e5a9886f001256433e03/2bc4a/lec8-critical-sections-mutual-exclusion.png 295w,\n/static/50265a3714c3e5a9886f001256433e03/fb8a0/lec8-critical-sections-mutual-exclusion.png 590w,\n/static/50265a3714c3e5a9886f001256433e03/526de/lec8-critical-sections-mutual-exclusion.png 885w,\n/static/50265a3714c3e5a9886f001256433e03/fa2eb/lec8-critical-sections-mutual-exclusion.png 1180w,\n/static/50265a3714c3e5a9886f001256433e03/50784/lec8-critical-sections-mutual-exclusion.png 1460w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<p>Requirements to avoid race conditions:</p>\n<ul>\n<li>No two processes may be simultaneously inside their critical sections</li>\n<li>No assumptions may be made about the speeds or the number of CPUs</li>\n<li>No process running outside its critical region may block other processes</li>\n<li>\n<p>No process should have to wait forever to enter its critical section</p>\n<ul>\n<li>a process should not remain in a critical section forever</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Concurrent Programming","date":"2019-02-07","description":""},"fields":{"slug":"/cpsc457/lec8-concurrent-programming","category":"cpsc457"}}},{"node":{"id":"3b2dddf8-2ed2-5f0a-8846-589b913b3803","html":"<p>In many ways threads are similar to processes. Both can be used to write applications that need some parallelism. However, min differences are: threads are more efficient, threads are more complicated to program correctly.</p>\n<p>Informally, a thread is \"a process within a process\", or \"mini process\". A process can have multiple threads, and a thread is always associated with a process. All threads within one process share the resources of the process. A process is like a container for all its threads. All threads are scheduled independently.</p>\n<h2>Process vs Thread</h2>\n<p>Both processes and threads can be used to write concurrent applications, but there are important differences</p>\n<ul>\n<li>processes are independent and self contained</li>\n<li>threads exists as a subset of process</li>\n<li>threads belonging to the same process share many/most resources with each other</li>\n<li>processes interact only through OS mechanisms (IPC = interprocess communication)</li>\n<li>threads have more options for communication</li>\n<li>processes have easier access to built-in OS mechanisms, but they are usually less efficient than threads</li>\n</ul>\n<h2>Common thread scenarios</h2>\n<ul>\n<li>\n<p><strong>pipeline</strong></p>\n<ul>\n<li>a task is broken into a series of stages</li>\n<li>each stage handled by a different thread</li>\n</ul>\n</li>\n<li>\n<p><strong>manager/worker</strong></p>\n<ul>\n<li>one manager thread assigns work to worker threads</li>\n<li>manager thread handles all I/O</li>\n<li>worker threads can be static or dynamic</li>\n</ul>\n</li>\n<li>\n<p><strong>peer</strong></p>\n<ul>\n<li>all threads work on the same or different tasks in parallel</li>\n</ul>\n</li>\n</ul>\n<h3>Thread pool</h3>\n<p><strong>Thread pool</strong> is a software design pattern. Program creates and maintained a pool of worker threads. Pool size can be tuned, e.g. to the available computing resources. When program needs a thread, it takes one out of the pool.</p>\n<!-- TODO: finish -->\n<h3>Thread libraries</h3>\n<h4>POSIX threads (aka pthreads)</h4>\n<p>To use POSIX threads:</p>\n<ul>\n<li><code class=\"language-text\">#include &lt;pthread.h&gt;</code></li>\n<li>compile with <code class=\"language-text\">gcc -lpthread</code></li>\n</ul>\n<p>pthread functions:</p>\n<ul>\n<li><code class=\"language-text\">pthread_create(thread, attr, start_routine, arg)</code> starts a thread, similar to <code class=\"language-text\">fork()</code></li>\n<li><code class=\"language-text\">pthread_exit(status)</code> terminates the current thread, similar to <code class=\"language-text\">exit()</code> or you can return from <code class=\"language-text\">start_routine</code></li>\n<li><code class=\"language-text\">pthread_join(thread, *status)</code> blocks the main, calling, thread until the specified thread terminates, similar to <code class=\"language-text\">wait()</code></li>\n<li>\n<p><code class=\"language-text\">pthread_attr_init(attr)</code> and <code class=\"language-text\">pthread_attr_destroy(attr)</code></p>\n<ul>\n<li>initializes/destroys thread attributes</li>\n<li>these can be tuned with <code class=\"language-text\">pthread_attr_set*()</code> functions</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Threads","date":"2019-02-05","description":""},"fields":{"slug":"/cpsc457/lec7-threads","category":"cpsc457"}}},{"node":{"id":"d18801b2-c197-50e3-b62b-3103925239ef","html":"<h2>CPU utilization</h2>\n<p>Example: OS is running 4 processes, P1, P2, P3 and P4</p>\n<ul>\n<li>P1 spends 40% of the time waiting on I/O (idle bound)</li>\n<li>P2 spends 20% of the time waiting on I/O</li>\n<li>P3 spends 50% of the time waiting on I/O</li>\n<li>P4 spends 90% of the time waiting on I/O (cpu bound)</li>\n</ul>\n<p>If there is only one CPU, what will be CPU's utilization? i.e. what percentage of the time is the CPU going to be running 'something'?</p>\n<p>Answer: CPU utilization = probability that at least one of the processes is <em>not</em> waiting on I/O = 1 - (probability that all processes are waiting on I/O) = <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mn>1</mn><mo>−</mo><mo>(</mo><mn>0.4</mn><mo>⋅</mo><mn>0.2</mn><mo>⋅</mo><mn>0.5</mn><mo>⋅</mo><mn>0.9</mn><mo>)</mo><mo>=</mo><mn>0.964</mn><mo>=</mo><mn>96.4</mn><mi mathvariant=\"normal\">%</mi></mrow><annotation encoding=\"application/x-tex\">1 - (0.4 \\cdot 0.2 \\cdot 0.5 \\cdot 0.9) = 0.964 = 96.4\\%</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">5</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">9</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">9</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.80556em;vertical-align:-0.05556em;\"></span><span class=\"mord\">9</span><span class=\"mord\">6</span><span class=\"mord\">.</span><span class=\"mord\">4</span><span class=\"mord\">%</span></span></span></span>.</p>\n<p>Assume <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.10903em;\">N</span></span></span></span> similar processes. Each process spends the same fraction <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span></span></span></span> of its time waiting on I/O, then:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mtext>CPU Utilization</mtext><mo>=</mo><mn>1</mn><mo>−</mo><msup><mi>P</mi><mi>N</mi></msup></mrow><annotation encoding=\"application/x-tex\">\\text{CPU Utilization} = 1 - P^{N}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord text\"><span class=\"mord\">CPU Utilization</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8913309999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathdefault\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913309999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathdefault mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span></span></span></span></span></span></span></span></span>\n<p>CPU utilization as a function of the number of processes in memory:</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11e030fe68a03680750dc057cf730deb/652d4/lec6-cpu-util-graph.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 63.0695443645084%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVQ4y6VT0Y6CQAzk/z/Ne9BojIA5jAcKuCAsCsii9joNcOQOnm6TFdidtjPTahGvtm3p9Xrhld7vN00t3ONu7r4/t/CTZZkk7VdrDMWXC2mtSamEmsb8CX4+n8Mek7EUBwZBQMY0cliWJUVhSJ7nkff5SZvNhlbLFbmuQ7ZtUxRFlChFlzgWIgrvnGNIeL/fKY5iYVgUhQBw5vtfnGhJ6/Vakgd+QBUXA2vgzqcTJUlCaZpSnuc/CVElPIfCLOaqt9tNns3jIUValoSAkFln16uw0/xt2Bbs3rvBQ1QEGE9UUx19LDCBbJHKGBSCZ3MN6SSXQv3EPh6PR7mo65ol+pIQ8rUuhDlwD2beB4+7PjDMcy2muq4rsq8sC8ZPMZli9DuxVVU1N8Anx3aEARKOA8d7PItz24I8x3HoY7GgkuX9d8lgi/G7nXQTXURjMD5oEraMR5IO32qEAT7uZlIYIiGMN00jhsNHsEZDsiwXIJIU3RSgObAJU4E44HPG4GxgONUtADEuDjfrcDjQfr+nHavYbrccXM3+778BIO/ray4/QsAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"CPU utilization as a function of the number of processes in memory\"\n        title=\"\"\n        src=\"/static/11e030fe68a03680750dc057cf730deb/fb8a0/lec6-cpu-util-graph.png\"\n        srcset=\"/static/11e030fe68a03680750dc057cf730deb/1a291/lec6-cpu-util-graph.png 148w,\n/static/11e030fe68a03680750dc057cf730deb/2bc4a/lec6-cpu-util-graph.png 295w,\n/static/11e030fe68a03680750dc057cf730deb/fb8a0/lec6-cpu-util-graph.png 590w,\n/static/11e030fe68a03680750dc057cf730deb/652d4/lec6-cpu-util-graph.png 834w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<h2>Resource allocation</h2>\n<p>There are several options for allocating resources for a new process:</p>\n<ul>\n<li>\n<p>child obtains resources directly from the OS</p>\n<ul>\n<li>most common and easiest to implement, most OS do this</li>\n<li><strong>drawback</strong>: something like 'for bomb' will destroy the system</li>\n</ul>\n</li>\n<li>\n<p>child obtains subset of parent's resources</p>\n<ul>\n<li>parent decides to give up some of its resources so that a child can use them</li>\n</ul>\n</li>\n<li>parent shares some/all resources with the child</li>\n</ul>\n<h3>Common parent-child execution scenarios</h3>\n<p>When child process is created, parent process usually does one of three things:</p>\n<ol>\n<li>\n<p>The parent waits until the child process <strong>is finished</strong></p>\n<ul>\n<li>\n<p>often used when child executes another program, e.g. <code class=\"language-text\">fork()</code>/<code class=\"language-text\">exec()</code>, or <code class=\"language-text\">system()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pid <span class=\"token operator\">=</span> fork<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> pid <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\nwait<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>The parent continues to execute concurrently and independently of the child process</p>\n<ul>\n<li>\n<p>e.g. autosave feature</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pid <span class=\"token operator\">=</span> fork<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> pid <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\ndo_something<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nexit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ul>\n</li>\n<li>\n<p>The parent continues to execute concurrently, but synchronizes with the child</p>\n<ul>\n<li>\n<p>can be complicated to synchronize</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">pid <span class=\"token operator\">=</span> fork<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> pid <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\ndo_something_1<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsynchronize<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ndo_something_2<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsynchronize<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># ...</span></code></pre></div>\n</li>\n</ul>\n</li>\n</ol>\n<h2>Process termination</h2>\n<p>Typical conditions which terminate a process:</p>\n<ul>\n<li>\n<p><strong>voluntary</strong></p>\n<ul>\n<li><em>normal exit</em> - application decides it's done, or user closes the app</li>\n<li><code class=\"language-text\">exit()</code> call</li>\n<li><em>error exit</em> - application detects an error, optionally notify the user</li>\n<li><code class=\"language-text\">exit()</code> call</li>\n</ul>\n</li>\n<li>\n<p><strong>involuntary</strong>:</p>\n<ul>\n<li><em>fatal error</em></li>\n<li>usually due to a bug in the program, detected by OS</li>\n<li>e.g. accessing invalid memory, div by zero</li>\n<li><em>involuntary</em> - killed by another process</li>\n<li>parent, or another process calls <code class=\"language-text\">kill()</code></li>\n<li>e.g. during shutdown, pressing <code class=\"language-text\">&lt;ctrl-c&gt;</code> in terminal, closing window</li>\n</ul>\n</li>\n</ul>\n<p>Parent may terminate its children for different reasons, for example:</p>\n<ul>\n<li>the child has exceeded its usage of some of the resources</li>\n<li>the task assigned to the child is no longer required</li>\n<li>the parent needs/wants to exit and wants to clean up first</li>\n</ul>\n<p>In Unix, when a parent process is terminated, the child processes may be terminated, or assigned to the grandparent process, or to the <code class=\"language-text\">init</code> process. Process hierarchy is always maintained. Default behavior on Linux is to <strong>reparent</strong> the child process to the <code class=\"language-text\">init</code> process. This can be changed (e.g. to kill children, reparent to some other process). Using <code class=\"language-text\">prctl()</code> system call, the behavior can be changed.</p>\n<p>When terminating a process, OS must free all related resources, e.g. free memory used by the process, delete PCB, delete process from process table, kill children or assign them to a new parent, close files, close open network connections.</p>\n<h2>Process scheduling</h2>\n<p>Part of multitasking is deciding which process gets the CPU next. Typical objective is to maximize CPU utilization. <strong>Process scheduler</strong> is a kernel routine/algorithm that selects an available process to execute on the CPU. Process is selected from a <em>ready queue</em>. OS maintains different scheduling queues:</p>\n<ul>\n<li>\n<p>job queue: all programs waiting to run, usually found in batch systems</p>\n<ul>\n<li>e.g. priority queue</li>\n</ul>\n</li>\n<li>\n<p>ready queue: all processes that are ready to execute their next instruction</p>\n<ul>\n<li>e.g. linked list, implemented via pointers</li>\n</ul>\n</li>\n<li>\n<p>device queue: processes waiting for a particular device</p>\n<ul>\n<li>each device has its own queue</li>\n</ul>\n</li>\n</ul>\n<h3>Process states</h3>\n<p>There are 3 process states:</p>\n<ul>\n<li><strong>running</strong> - actually running on the CPU</li>\n<li><strong>blocked</strong> - waiting for some event to occur, e.g. I/O</li>\n<li><strong>ready</strong> - the process is ready to execute on CPU</li>\n</ul>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5796eb8a31c5e6b7b767782008a727f7/a062e/lec6-process-fsm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 29.153605015673982%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABHElEQVQY03VRO0vDUBTOKP4b0cHN0R8ghU6Ojo76lxx0Kx0dFCwKPouEbhlsHjTJvWma3OS+Pk+uhiqlHxwOnHv4Hud66GDtT8MahkrKFmEYIQgCNI34974NXsGZW5SrAPz9FMnTAOx1CJG/uQXZNkRWOYF6cYfs+QTJ4wD84wxSpFiWFRhjJC7Jl4XXKWtibAof6eQIs/EBkvtD1OkDFLFwvkRZrqA7wniMr9s9+KN9JJNjyDpCKw0aIaCUcuXhT1hNBIpi9hOtFVgWgrMYRuv1pjXbI3c2rbuhhTEGWZa7CEpZ5C9D+Ne7mN3sgH+ekxsgCucoiuXv6e1Gebb/kL4TqTsDmajmV1hML5FOLyDikZvlWYq6rjYIe3wD183EapkJFZsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Process states\"\n        title=\"\"\n        src=\"/static/5796eb8a31c5e6b7b767782008a727f7/fb8a0/lec6-process-fsm.png\"\n        srcset=\"/static/5796eb8a31c5e6b7b767782008a727f7/1a291/lec6-process-fsm.png 148w,\n/static/5796eb8a31c5e6b7b767782008a727f7/2bc4a/lec6-process-fsm.png 295w,\n/static/5796eb8a31c5e6b7b767782008a727f7/fb8a0/lec6-process-fsm.png 590w,\n/static/5796eb8a31c5e6b7b767782008a727f7/526de/lec6-process-fsm.png 885w,\n/static/5796eb8a31c5e6b7b767782008a727f7/fa2eb/lec6-process-fsm.png 1180w,\n/static/5796eb8a31c5e6b7b767782008a727f7/a062e/lec6-process-fsm.png 1276w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>Only 4 transitions are possible:</p>\n<ul>\n<li>ready <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> running</li>\n<li>running <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> ready</li>\n<li>running <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> blocked</li>\n<li>blocked <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> ready</li>\n</ul>\n<h3>Context switching</h3>\n<h3>Unix signals</h3>\n<p>A form of <strong>interprocess communication</strong> (IPC):</p>\n<ul>\n<li>It's a similar concept to interrupts on CPUs. Interrupts on the application level. If application sends a signal to another application, that process is interrupted.</li>\n<li>Asynchronous</li>\n<li>Very limited IPC - messages consist of only small set of predefined integers</li>\n</ul>\n<p>A signal is used to notify a process that a particular event has occured. One process (or thread) sends a signal, another process (or thread) received it. It is possible for a process to signal itself. Signal lifetime:</p>\n<ul>\n<li>Signal is <strong>generated/sent</strong>, usually as a consequence of some event</li>\n<li>Signal is <strong>delivered/pending</strong> to a process</li>\n<li>Delivered signal is <strong>handled</strong> by the process via a <strong>signal handler</strong>.</li>\n<li>Some signals can be <strong>ignored</strong> - signal delivered to a process that ignores it, is lost</li>\n<li>Some signals can be <strong>blocked</strong> - signal stays pending until it is unblocked</li>\n</ul>\n<h4>Generating signals</h4>","frontmatter":{"title":"Processes, pt2","date":"2019-01-31","description":""},"fields":{"slug":"/cpsc457/lec6-processes-pt2","category":"cpsc457"}}},{"node":{"id":"508068ae-1b0c-5cad-8414-7e6aa7fb2ea3","html":"<!--TODO: Finish processes-->\n<p>Process is a key concept in all operating systems. A quick definition of a process is <mark>a program in execution</mark>. Process is associated with:</p>\n<ul>\n<li>an address space</li>\n<li>set of resources</li>\n<li>program counter, stack pointer</li>\n<li>unique ID (process ID, <strong>PID</strong>)</li>\n</ul>\n<p>Process can be though of as a container that holds all information needed by an OS to run a program.</p>\n<h2>Process Tree</h2>\n<p>Processes are allowed to create new processes.</p>\n<h2>Pipes</h2>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cf22c70cb9dd12a15b076088107dbe51/4a6b5/lec5-pipe.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 37.920489296636084%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWUlEQVQoz41Sa2+CUAzl//+jJXzYmAoiY/LwwRAEJANEhWVbJDw8o900mizLTtJc2tuenvYiqKqGeBNh5fnwPA++v0bTtiCcTid0Xcfn2QhNU2M4GMJ1V4iiiOucFxdZtoUQhRvomob7BwmWacG0bFR1g9/xTVjXNcIgxHodYDQcQZZlTKcm+0KSvHKHOI77ju5N+VtZQH/Ssc1y5HmOtu1Y8Vk95VOd7/tIkoTjwmKxuBDsdjtc+9XxiLk9h/w4wvPUuGnmOA7SNL34y+WSSYW277hNEzwOZL4g+ZIkYTweQ1VV6LrOMa1fi6IomEwmEEWxjymcL96J8PwQVXXkSYX9fs8X7x+ffBLRbDbjjqSW7PqblFmWxeSEsijR9aulldDogmEYLLUoCti23b9Uhv+ACIi4LEse3TTNXmUFgV6Mnj4MQxwOB06mxf9l7c9vRSKCIOB6IiN8AQIMVE/lrwPCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Pipe process\"\n        title=\"\"\n        src=\"/static/cf22c70cb9dd12a15b076088107dbe51/fb8a0/lec5-pipe.png\"\n        srcset=\"/static/cf22c70cb9dd12a15b076088107dbe51/1a291/lec5-pipe.png 148w,\n/static/cf22c70cb9dd12a15b076088107dbe51/2bc4a/lec5-pipe.png 295w,\n/static/cf22c70cb9dd12a15b076088107dbe51/fb8a0/lec5-pipe.png 590w,\n/static/cf22c70cb9dd12a15b076088107dbe51/4a6b5/lec5-pipe.png 654w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>Pipes is a very powerful thing in Unix. On Unix systems, two processes can communicate with each other via a <strong>pipe</strong>. Pipes are accessed using file I/O APIs. Pipes <em>can</em> be bidirectional, but normally used as one directional.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">ls</span> -altr <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -10</code></pre></div>\n<p>Pipes allow parallelization: two programs will be executed in parallel.</p>\n<h2>Unix file APIs</h2>\n<p>Unix-like OSs make use of files and associated APIs for different operations/services. For example, if pipes are used programmatically, pipe will be used as some file.</p>\n<hr>\n<p>We want the ability to run multiple programs at the same time, aka <mark>multitasking</mark>. For this we need firm control and compartmentalization of the various programs. To this end we create an abstraction of <strong>program in execution</strong> and call it a <strong>process</strong>.</p>\n<h2>Multitasking</h2>\n<p>Process abstraction is used to implement <strong>multitasking</strong>. Multitasking allows an <strong>illusion</strong> of parallelism:</p>\n<ul>\n<li>running <code class=\"language-text\">N</code> processes with <code class=\"language-text\">M</code> CPUs, <code class=\"language-while n \"> M</code></li>\n<li>\n<p>works even with a single CPU:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">run program (i) for a fraction of a second\nswitch to program (i+1)\nrepeat</code></pre></div>\n</li>\n</ul>\n<p>Multitasking allows us to reduce CPU idling during I/O. CPU could be given to another process rather than remain idle. Multitasking is only practical when memory is big enough to hold multiple programs.</p>\n<p><strong>Program <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mi mathvariant=\"normal\">≠</mi></mrow><annotation encoding=\"application/x-tex\">\\neq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel latin_fallback\"≯</span></span><span class=\"fix\"></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span><span class=\"mrel\">=</span></span></span></span></span> Process</strong>:</p>\n<ul>\n<li>\n<p>A <em>program</em> is a <strong>passive</strong> entry</p>\n<ul>\n<li>an executable file containing a list of instructions, usually stored on disk</li>\n</ul>\n</li>\n<li>\n<p>A <em>process</em> is an <strong>active</strong> entity</p>\n<ul>\n<li>associated with a <em>program counter</em> and other resources</li>\n</ul>\n</li>\n</ul>\n<h2>A process in memory</h2>\n<p>Each process gets its own <strong>address space</strong>. Part of memory available to a process, decided by OS. On modern OSes it is a <em>virtual</em> address space (0 - max), isolated from other processes.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5a9af13c99a58a73bb6a32989f54b68e/9f11a/lec5-mem-stack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 434px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 140.55299539170508%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAABYlAAAWJQFJUiTwAAADEklEQVRIx6VWTXPaMBTk9/eYWw+5pjSn0KSdIZcmLfXUpOFzCAFjYoNtDOYbAiWTZKtVRmAbp5NOmdl5kvZp9Z4kP5F6fHzEw8NDIjabzRZJ3NPTE4bDITRNw+XlJRqNBlJBEKDT6aDX68HzvC3YpzN52jhPuK4Ly7Jk2zAM6ZOi82AwwGQywXg8lmCbY+VyWa5K6/u+GJ9GfNSC4V9qNBpJYjabYTqdSsf5fC5XPz4+RiaTwcnJicxisVhInn4Ehbkwf0z/+fkZKYZptFqwbVuGr2DbHXiCcxxHpmQLwShvwzRNdLtdKUgxGWHbDZC76eHKHCJvBFvoxgD51hBfcmXozUGEI64Ep932cWv5LxEqQcufQG/PUXJWKHTvBV5sUdhre4mDwyPk6j7K3gaFjuJXKAr/vLVE0xlFI7R6Y/w0Jyh2lkJgEUFBjB2mP0FrDMQC93uc3p6h2R0mCU7FhOXWsdDZtUvuWkacxOl387cJhm04orj9J8Fde/7/guHUyt7viMgbBV85FLF3mYtr5NuTxC1IPhRxbfJipbK7kifJ60Arr5GY9O7gPb7XXFR6mx0vQP6XuFZG/Nq0nABfqx60ZoAft4MXiGuSkzbAx6yGb+Lis81x5aOJ/kXNR+0udrHdno+6cQfTdtCyuluw3/H6MNrik3R6MK0YL/oNU3yCXScaIYvDaBhgPptiNp1IsD0UVeSmVhPfawum+NbHIxaQnc+MhWQ8EtVmEBX8W/k6O/uMo6MPSKfTskCoChMuX6rabAU5wIrS7/dlzVNgn7WObZayMKd4VYgjgiTb7bYUZSkKQ03konGOYBnjvL09ZCSquIbBSl0oFFAsFkG/sA/bHNtL+TVBjp+fn8uKfXp6KqNVexj22RNkSgyd+8TwFdhX6RJJPJ8F2sRDoaWAAiNSadKq/QwjfijyTVEpq2ujLB8k7h/T1nVdPlzhdJOujRRMuodchAKVSgXZbBalUkm+iopPekYjh8LQ4ykTnEhhTo5zBAWr1Srq9fpWNMW/Iuv1OhGr1WqLJJ5/R7jH4bT/AEQqHwCJDyDEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Memory stack\"\n        title=\"\"\n        src=\"/static/5a9af13c99a58a73bb6a32989f54b68e/9f11a/lec5-mem-stack.png\"\n        srcset=\"/static/5a9af13c99a58a73bb6a32989f54b68e/47618/lec5-mem-stack.png 148w,\n/static/5a9af13c99a58a73bb6a32989f54b68e/527c6/lec5-mem-stack.png 295w,\n/static/5a9af13c99a58a73bb6a32989f54b68e/9f11a/lec5-mem-stack.png 434w\"\n        sizes=\"(max-width: 434px) 100vw, 434px\"\n      />\n  </span>\n  </a></p>\n<ul>\n<li><strong>text section</strong>: the program code</li>\n<li><strong>data section</strong>: global variables, constant variables</li>\n<li><strong>heap</strong>: memory for dynamic allocation during runtime</li>\n<li><strong>stack</strong>: temporary data (parameters, return address, local variables)</li>\n</ul>\n<p>Other information needed by the OS for management, usually grouped in a Process Control Block data structure.</p>\n<h3>Process control block</h3>\n<!-- NOTE: Remember what goes to PCB -->\n<p>Each process is represented in the OS by a PCB that includes:</p>\n<ul>\n<li>process state</li>\n<li>program counter</li>\n<li>CPU registers</li>\n<li>CPU-scheduling info priority, pointers to the queue, other parameters</li>\n<li>memory management info: page tables, segment tables, etc.</li>\n<li>accounting info: CPU time, timeout values, process numbers, etc.</li>\n<li>I/O status info: open files, I/O devices, etc.</li>\n</ul>\n<p>On Linux, <a href=\"https://github.com/torvalds/linux/blob/master/include/linux/sched.h\"><code class=\"language-text\">task_struct</code></a> is the <code class=\"language-text\">struct</code> that stores information about processes.</p>\n<p>The <strong>process table</strong> is a collection of all PCBs. Some of the fields of a PCB</p>\n<table>\n<thead>\n<tr>\n<th>Process management</th>\n<th>Memory management</th>\n<th>File management</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>program counter</td>\n<td>pointer to text segment</td>\n<td>root directory</td>\n</tr>\n<tr>\n<td>registers</td>\n<td>pointer to data segment</td>\n<td>working directory</td>\n</tr>\n<tr>\n<td>stack pointer</td>\n<td>pointer to stack segment</td>\n<td>file descriptors</td>\n</tr>\n<tr>\n<td>priority</td>\n<td>user ID</td>\n<td></td>\n</tr>\n<tr>\n<td>scheduling parameters</td>\n<td>parent ID</td>\n<td></td>\n</tr>\n<tr>\n<td>PID</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>parent process</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>process group</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>signals</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>process start time</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>CPU time used</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>children's CPU time used</td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h2>Operations on processes</h2>\n<p>Processes need to be created and deleted dynamically and OS must provide mechanisms for this. Process creation on Unix is done via <code class=\"language-text\">fork()</code>:</p>\n<ul>\n<li><strong>parent process</strong> - the process that is creating a new process</li>\n<li><strong>child process</strong> - the newly created process</li>\n<li>processes in the system form a <strong>process tree</strong></li>\n<li>each process gets <strong>PID</strong>, a unique ID</li>\n</ul>\n<p>Process is executed via <code class=\"language-text\">fork()</code>:</p>\n<ul>\n<li>under Unix there's no difference, but under Win, there is (have to create <em>then</em> execute)</li>\n</ul>\n<p>Process termination is done via <code class=\"language-text\">exit()</code> or <code class=\"language-text\">kill()</code>:</p>\n<ul>\n<li>to let the OS delete the process</li>\n<li>termination can be (typically) only requested by the process or its parent</li>\n</ul>\n<p>There are other operations: synchronization, communication, etc.</p>\n<h2>Multiprocess program in C</h2>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Create &amp; run child process - duplicate of parent</span>\n  <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Both parent and child will execute the next line</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"world.\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There can be several possible outputs (due to buffering, or if <code class=\"language-text\">fork()</code> fails):</p>\n<ul>\n<li>\n<p>If <code class=\"language-text\">printf()</code> is unbuffered</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hello\nworld.\nworld.</code></pre></div>\n</li>\n<li>\n<p>If first process got interrupted, due to multitasking</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hello\nworwold.\nrld.</code></pre></div>\n</li>\n<li>\n<p>If <code class=\"language-text\">fork()</code> (returns <code class=\"language-text\">-1</code>) fails</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hello\nworld.</code></pre></div>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// create &amp; run child process - a duplicate of parent and remember the return value</span>\n  pid_t pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// both parent and child will execute the next line, but will have different value for pid</span>\n  <span class=\"token comment\">// 0 for child</span>\n  <span class=\"token comment\">// non-zero for parent</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PID: %d\\n\"</span><span class=\"token punctuation\">,</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<!-- NOTE: what if fork is in a loop? -->\n<p>There also can be different outputs:</p>\n<ul>\n<li>\n<p>If parent was executed first</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PID: 7\nPID: 0</code></pre></div>\n</li>\n<li>\n<p>If child was executed first</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PID: 0\nPID: 7</code></pre></div>\n</li>\n<li>\n<p>If <code class=\"language-text\">fork()</code> failed</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">PID: -1 </code></pre></div>\n</li>\n</ul>\n<hr>\n<!--fork urself, check if a child, exec a child-->\n<p>Executing a process by replacing the current process with a new process using <code class=\"language-text\">execl()</code>, <code class=\"language-text\">execlp()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span>\n<span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;unistd.h></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// create and run child process - a duplicate of parent</span>\n  pid_t pid <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// both parent and child will execute this statement</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// error ocurred</span>\n    <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// child process</span>\n\n    <span class=\"token comment\">// replace process with `ls -l`</span>\n    <span class=\"token function\">execlp</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bin/ls\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ls\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-l\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// parent process will wait for the child to complete</span>\n\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"waiting for child process: %d\\n\"</span><span class=\"token punctuation\">,</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Another way of doing system calls is using <code class=\"language-text\">system()</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token macro property\">#<span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdlib.h></span></span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/*\n    The system() library call uses fork() to create a child process that\n    executes the shell command\n  */</span>\n  \n  <span class=\"token function\">system</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bin/ls\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Process Tree</h2>\n<h2><code class=\"language-text\">init</code> Process</h2>\n<p><code class=\"language-text\">init</code> or <code class=\"language-text\">systemd</code> is the first process started after booting. Older Unix systems use <code class=\"language-text\">init</code>, but many popular Linux systems now switched to <code class=\"language-text\">systemd</code>. <code class=\"language-text\">init</code> is the ancestor of all user processes (direct or indirect parent), i.e. root of process tree. PID of <code class=\"language-text\">init</code> is always <code class=\"language-text\">PID = 1</code>. Orphaned processes are adopted by <code class=\"language-text\">init</code>. Process tree can be printed using following:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pstree <span class=\"token comment\"># or</span>\n<span class=\"token function\">ps</span> axjf</code></pre></div>\n<p>Note: some special system 'processes', or kernel threads, are created by kernel during bootstrap, and do not have to be descendants of <code class=\"language-text\">init</code>, such as <code class=\"language-text\">swapper</code> and <code class=\"language-text\">pagedaemon</code>.</p>\n<!-- 1 cpu & 4 virtual PCs -->\n<!-- program becomes a process when it's *loaded* -->","frontmatter":{"title":"Processes pt.1","date":"2019-01-29","description":""},"fields":{"slug":"/cpsc457/lec5-processes-pt1","category":"cpsc457"}}},{"node":{"id":"a4ee6eaf-b581-51b0-b2cc-2d0919f8553b","html":"<p>OS provides services to application, e.g. access to hardware, via higher level abstractions, resource management. These OS services are accessible through <strong>system calls</strong>, aka kernel calls, usually handled via <strong>traps</strong> (software interrupts).</p>\n<h2>System Calls</h2>\n<p>When an application wants to access a service/resource of the system, the application must make an appropriate <strong>system call</strong>, call a routine by the OS. It is done using <strong>traps</strong>.</p>\n<p>Trap is a special CPU instruction that switches from user mode to kernel mode. A trap invokes a pre-defined trap handler, registered by kernel.</p>\n<p>Inside trap handler:</p>\n<ul>\n<li>OS saves application state</li>\n<li>OS does the requested operation</li>\n<li>OS switches back to user mode and restores application state</li>\n</ul>\n<p>From application perspective, making a system call is just like calling any other routine.</p>\n<p>System calls provide an interface to the services made available by OS:</p>\n<ul>\n<li>API provided by the OS</li>\n<li>Interface for system calls varies from OS to OS</li>\n</ul>\n<h3>Libraries and system calls</h3>\n<p>System calls are minimalistic and not easy to use. Usually they are implimented in assembly, optimized for performance. System call number and parameters usually passed in registers.</p>\n<div class=\"gatsby-highlight\" data-language=\"asm\"><pre class=\"language-asm\"><code class=\"language-asm\">mov eax, 4   ; system call # (sys_write)\nmov ebx, 1   ; fd = stdout\nmov edx, 4   ; message length\nmov ecx, msg ; pointer to message\nint 0x80     ; trap</code></pre></div>\n<p>Quite inconvenient to use from higher level languages. Preferred way to make system calls through higher-level wrappers, e.g. <code class=\"language-text\">libc</code>, <code class=\"language-text\">libstdc++</code>, <code class=\"language-text\">libc++</code>.</p>\n<p>A library can provide a set of functions (API). APIs hide implementation details of system calls, making system calls via wrappers is more convenient.</p>\n<h4>Example: <code class=\"language-text\">printf()</code></h4>\n<ul>\n<li><code class=\"language-text\">write()</code> prepares arguments in registers</li>\n<li><code class=\"language-text\">write()</code> calls the <code class=\"language-text\">write</code> system call</li>\n<li><code class=\"language-text\">write()</code> takes the value returned by <code class=\"language-text\">write</code> and passes back to the caller</li>\n</ul>\n<p><code class=\"language-text\">printf()</code> does some formatting and then system calls <code class=\"language-text\">write</code></p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7341b971a5632375016cb91395275689/ee358/lec4-printf.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 528px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 100.37878787878789%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzklEQVQ4y4WU2Q6CQAxF5///zGcfcIs77vuGAlpzmpRUAtikYRjaO7e9ZYI4+3w+xdPWdZbnubrPwUId4Gw2kyiKpNfrqcdxLO12WzqdjkynU7nf73K73SRN02ZA+0DSaDRSUEA2m41cr1d5PB7yer00JsuyYt3I8P1+y36/1wSc0tgrG2AeEK8FBARWTUa5xP1lmCSJXC4XWa/XMp/PZbvdKjjvq9VK/XA4aPl8M/a1DAEhiT4ul0s5n89yPB5lsVgoKAKx93w+pd/va28bAWFD8Ol0+js6VALTAtCa6RWGBUE8u92uMrN++jgAKZ0RagQkmZJRkH6amjbMpjyi0IofwKqSGRmAPIB3gHDEoH8MeAFID4bDofbCNmk0gGXzvyNrAGHnYwNqodput9MPnEb/YEDZ/C34ZDLRuPF4rM64EANjyACMB4JI4ImyBkap9AdhcAA4nIN55xsxEMAhgwd6gIr0DbP5+nfbmMHOj9ePKNCHCSwYaEowEUwcU9sb8cW/XB4ZSoE17zA1Re2mQQgbJ1t7QUPVXUgiCawB4z5stVoyGAxUHGsJMbD2GKEM5q8mgukp5TPs9Io1bDmImNobu+r6t1mzJwf4varcL8EIFoelcM5oAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"`printf()`\"\n        title=\"\"\n        src=\"/static/7341b971a5632375016cb91395275689/ee358/lec4-printf.png\"\n        srcset=\"/static/7341b971a5632375016cb91395275689/6d88e/lec4-printf.png 148w,\n/static/7341b971a5632375016cb91395275689/bd048/lec4-printf.png 295w,\n/static/7341b971a5632375016cb91395275689/ee358/lec4-printf.png 528w\"\n        sizes=\"(max-width: 528px) 100vw, 528px\"\n      />\n  </span>\n  </a></p>\n<h4>Syscalls in C</h4>\n<table>\n<thead>\n<tr>\n<th>call</th>\n<th>description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"language-text\">fd = open(file, how, ...)</code></td>\n<td>open a file for reading, writing, or both</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">s = close(fd)</code></td>\n<td>close an open file</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">n = read(fd, buffer, nbytes)</code></td>\n<td>read data from a file into a buffer</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">n = write(fd, buffer, nbytes)</code></td>\n<td>write data from a buffer into a file</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">position = lseek(fd, offset, whence)</code></td>\n<td>move the file pointer</td>\n</tr>\n<tr>\n<td><code class=\"language-text\">s = stat(name, &amp;buf)</code></td>\n<td>get file metainfo</td>\n</tr>\n</tbody>\n</table>\n<p>System calls can be traced using <code class=\"language-text\">strace</code> (linux) or <code class=\"language-text\">dtruss</code> (macos).</p>\n<!-- why open a file and then read it? -->\n<!--- open is more expensive, read reuses whatever open has done.-->\n<!--- convenience. Always read from the beginning of the file-->","frontmatter":{"title":"System calls","date":"2019-01-24","description":""},"fields":{"slug":"/cpsc457/lec4-sys-calls","category":"cpsc457"}}},{"node":{"id":"22b1cb68-7d97-5c7f-85fb-7499b57666d0","html":"<h2>Interrupts</h2>\n<p>Interrupt can happen at any time. When interrupt happens, CPU switches to kernel mode and interrupt handler executes the interrupt. CPU state is saved by the interrupt handler before executing code in interrupt handler. After executing interrupt, CPU restores state and switches back to user mode. Source of the interrupts is usually devices.</p>\n<h3>Software interrupts (exception/traps)</h3>\n<p>Similar to hardware interrupts but the source of the interrupt is the CPU itself. Software interrupts are handled similarly to hardware interrupts.</p>\n<p>There are two types of software interrupts: <em>intentional</em> and <em>unintentional</em>.</p>\n<h4>Unintentional interrupts</h4>\n<p>Also called <strong>exceptions</strong>. Occurs when CPU executes invalid instruction (e.g. accessing non-existent memory, write to ROM, division by zero). Unintentional interrupts used by OS to detect when an application attempts an illegal operation.</p>\n<h4>Intentional interrupts (trap)</h4>\n<p>Trap usually occurs via special instruction, e.g. <code class=\"language-text\">INT</code>. The purpose of a trap is to execute predefined routine in <em>kernel mode</em>. OS can use traps to implement system calls.</p>\n<h3>Hardware interrupts vs Software interrupts</h3>\n<ul>\n<li>\n<p><strong>Hardware Interrupts</strong>:</p>\n<ul>\n<li>Exernal event delivered to the CPU</li>\n<li>Origins: I/O, timer, user input</li>\n<li>asynchronous with the current activity of the CPU</li>\n<li>the time of the event is not known and not predictable</li>\n</ul>\n</li>\n<li>\n<p><strong>Software Interrupts</strong>:</p>\n<ul>\n<li>internal events, e.g. system calls, exceptions</li>\n<li>synchronous with the current activity of the CPU</li>\n<li>occurs as a result of execution of a machine instruction</li>\n</ul>\n</li>\n<li>\n<p>Both hardware and software interrupts:</p>\n<ul>\n<li>invoke a kernel routine, defined by the OS</li>\n<li>put the CPU in a kernel mode</li>\n<li>save the current state of the CPU</li>\n<li>eventually resume the original operations when done</li>\n</ul>\n</li>\n</ul>\n<h3>I/O</h3>\n<p>How does the kernel handle I/O? There are two options.</p>\n<ul>\n<li>\n<p><em>Option 1</em>: busy waiting/spinning/busy looping (aka polling).</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cpu -&gt; disk: read a file\nloop:\n  cpu -&gt; disk: u done?\n  break if done\ncpu -&gt; disk: give result</code></pre></div>\n<ul>\n<li>There are problems with is:</li>\n<li>the CPU is tied up while slow I/O completes the operation <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mtext>&ThickSpace;</mtext><mo>⟹</mo><mtext>&ThickSpace;</mtext></mrow><annotation encoding=\"application/x-tex\">\\implies</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.549em;vertical-align:-0.024em;\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">⟹</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span></span></span> CPU could be doing other operations</li>\n<li>Power is wasted</li>\n</ul>\n</li>\n<li>\n<p><em>Option 2</em>: busy wait with sleep</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cpu -&gt; disk: read a file\nloop:\n  sleep\n  cpu -&gt; disk: u done?\n  break if done\ncpu -&gt; disk: give result</code></pre></div>\n<ul>\n<li>Sleep could be detected by OS and the CPU could then run another program</li>\n<li>\n<p>Problems:</p>\n<ul>\n<li>hard to estimate the right amount of sleep</li>\n<li>program might end up running longer than necessary</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><em>Option 3</em>: Hardware interrupts</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cpu -&gt; disk: read a file\ncpu -&gt; disk: update when done\ncpu: sleep until interrupted\ndisk -&gt; cpu: interrupt\ncpu -&gt; disk: give result</code></pre></div>\n<ul>\n<li>When the I/O device finishes the operation, it generates an interrupt, letting the OS know it's done, or there was an error</li>\n<li>This approach assumes the I/O device supports interrupts</li>\n</ul>\n</li>\n</ul>\n<h4>Using interrupts to do I/O</h4>\n<p>Kernel talks to the device driver to request an operation. The device driver tells the controller what to do by writing into device registers. The controller starts the device and monitors its progress. When the device is done its job, the device controller signals the interrupt controller. The interrupt controller informs the CPU and puts the device information on the bus. The CPU suspends current process and handles the interrupt by executing the appropriate interrupt handler (in kernel mode). The CPU then resumes its original process.</p>\n<h3>Limits of interrupts</h3>\n<ul>\n<li>CPU can run other programs while waiting for I/O</li>\n<li>\n<p>CPU could be interrupted for every single byte of I/O</p>\n<ul>\n<li>many devices/controllers have limited memory</li>\n<li>these devices could generate an interrupt for every single input byte</li>\n<li>interrupts take many CPU cycles to save/restore CPU state</li>\n<li>useful work often a single instruction - to store the data in memory</li>\n</ul>\n</li>\n</ul>\n<p>To solve these problems, introduce a dedicated hardware to deal with interrupts - DMA chip</p>\n<ul>\n<li>DMA absorbs most interrupts</li>\n<li>DMA can save data directly into memory, without CPU knowing</li>\n<li>result is less interrupts for the CPU</li>\n</ul>\n<h4>Direct memory access (DMA)</h4>\n<p>It is a special piece of hardware on most modern systems. DMA used for bulk data movement such as disk I/O. It is usually used with slow devices so that CPU can do other things, but also could be used with extremely fast devices that could overwhelm CPU.</p>\n<p>Device controller transfers an entire block of data directly to the main memory without CPU intervention. Only one interrupt is generated per block - to tell the device driver that the operation has completed. Used for device <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> memory, memory <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> device, and memory <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mo>→</mo></mrow><annotation encoding=\"application/x-tex\">\\to</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.36687em;vertical-align:0em;\"></span><span class=\"mrel\">→</span></span></span></span> memory transfers.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54080e443e90f6a5fd10f10375cbad17/988e0/lec3-dma.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.85714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8klEQVQoz4WT3WrUQBTH80Dee+creOcb+BKleqNiL7yQgogirrioiK6gti6IYLWliraFUuyitW7XzWaz2U2ymSQz+ZjM35OMu6ZS8cCP4Zzk/DkfM4YUCZQsUJpSqjrzLMfIdiDoWz3+t83inAtklFOa0XpxE3tfNrWQ1MG1rXVcurOEB6sPKSbnySdRWmd/D0PL1IK3Ghfw+ePLyimUTl7feYtr96/gyesmZCFn9dROdczf+fQBjj3Ugt6YIzbHEIkEFzl4UoBPI5gWQ5wpCIJn+CdJruCOBSKWoizYiKIMrhPCN114JX1i4MOxQnijElYjhGuzipk/dRgGZoDeMEZBqzBqI8bJpv6LUsWfpWScQ4Ts9wy1aJbn6P7swbJtnaL0UsrLMA44GPU6i5WWpiltmmvB9psmHj1brhxZ6OvT6X7F4o2LuNy4CssZzmtdaHVw6vwyTi+uYO1bMI8fdQ+xu7ulBTc2n6Pdvnesbcvpo7lyF49fNTANvXni2esbMM4swDh3G0+3hzXBH+h9P9CCBbU+mZQblgh5Qe1IiBTwImIkaBwpWJAgonN730brXR+r7w/RswJwWmjEBHw3wdjN6UFIGOWr8KcJmM8ReISv8d24IpiERFSdGc0vj1PItEDMEkzp/9AXVFCMowFDSlfsF6PgPBGPOVZCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"DMA\"\n        title=\"\"\n        src=\"/static/54080e443e90f6a5fd10f10375cbad17/fb8a0/lec3-dma.png\"\n        srcset=\"/static/54080e443e90f6a5fd10f10375cbad17/1a291/lec3-dma.png 148w,\n/static/54080e443e90f6a5fd10f10375cbad17/2bc4a/lec3-dma.png 295w,\n/static/54080e443e90f6a5fd10f10375cbad17/fb8a0/lec3-dma.png 590w,\n/static/54080e443e90f6a5fd10f10375cbad17/526de/lec3-dma.png 885w,\n/static/54080e443e90f6a5fd10f10375cbad17/988e0/lec3-dma.png 1120w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<hr>\n<h2>Kernel Designs</h2>\n<p>What goes into a kernel and what does not? There are trade-offs to consider:</p>\n<ul>\n<li>code in kernel runs faster, but</li>\n<li>big kernels have more bugs <span class=\"katex\"><span class=\"katex-mathml\"><math><semantics><mrow><mtext>&ThickSpace;</mtext><mo>⟹</mo><mtext>&ThickSpace;</mtext></mrow><annotation encoding=\"application/x-tex\">\\implies</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.549em;vertical-align:-0.024em;\"></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">⟹</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span></span></span> higher system instability</li>\n</ul>\n<p>There are three main kernel designs: <strong>monolithic kernel</strong>(MS-DOS, Linux), <strong>microkernels</strong>(Mach, QNX), <strong>hybrid kernels</strong>.</p>\n<h4>Monolithic kernel</h4>\n<p>The entire OS runs as a single program in kernel mode. It is faster  but more prone to bugs, harder to port, and potentially less stable.</p>\n<h4>Microkernel</h4>\n<p>Only essential components in kernel - running in kernel mode (essential = code that must run in kernel mode). The rest is implemented in user mode. Most likely will be less bugs, easier to port and extend, more stable, but slower.</p>\n<h4>Hybrid kernel</h4>\n<p>Trying to balance the cons/pros of monolithic kernels and microkernels</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/42ecb17845b89a0f7900a2a918f4fdf9/1fe1a/lec3-kernel-designs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.64179104477612%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAACA0lEQVQozyWPW0jTcRzFfz71VkERSEaJ0EP0EBVB0EMPQZnloNSV5rL0P5U5U0uTdJq4NtmshS3TvJF52e2/vzq1xog0NxRJ6UJ0kcoIosASTNB6+fSTDhwOnHP4XgQrRXTP6LgdTaF58iT2sSPMzhvgbylfvyu4ose5E0vFNZ4sNZmFhXxYLeHbD4Wm2Jqnk1kKTdETLC0WIuZjgrJGgaFOoFjjOGMReFTBymfBxBPBxXpBrl2q5DnZmR4X/H4veBYRnJVdo/Qv3BAUOgRvJgViIGETDfY+LM0Rqm+qVLdP0WM08LpLFqKJLIXMhKf3M/LuGlcbVDTPVj5NCXrVfRwq7kcb2k7L3EZeyOUvJ+TA1oR4LtmGUVpnUW6NoXR/oO5YPt1JgkdtiSyOFKDN7Mb3sYqcmhA19fEE5TXutG0Y96YSsu6iv30PkU4dgdzNiKI4+bJVo9gdw+wMU/bgLWVHszALgfNAEk87nLR1KHT6XFTV+jHv3ECFzMrXrcd28DAhZwVdlXa8feNYtuxARFruYcq7QnamGSWnFL3exN3K67y676a3toG0U2bOp5eTLTUv08SorZHn7ib6bA5OZ18mI6uE9KwiMvQFDDkcCCRGw4/x+H0EBzUe9vYw92V+zebn8hK+gBd1MIB/QFILssp//Fpexuf3EtRU1GAAVWZ/pP8PR3RqWNDmnVEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Kernel designs\"\n        title=\"\"\n        src=\"/static/42ecb17845b89a0f7900a2a918f4fdf9/fb8a0/lec3-kernel-designs.png\"\n        srcset=\"/static/42ecb17845b89a0f7900a2a918f4fdf9/1a291/lec3-kernel-designs.png 148w,\n/static/42ecb17845b89a0f7900a2a918f4fdf9/2bc4a/lec3-kernel-designs.png 295w,\n/static/42ecb17845b89a0f7900a2a918f4fdf9/fb8a0/lec3-kernel-designs.png 590w,\n/static/42ecb17845b89a0f7900a2a918f4fdf9/526de/lec3-kernel-designs.png 885w,\n/static/42ecb17845b89a0f7900a2a918f4fdf9/fa2eb/lec3-kernel-designs.png 1180w,\n/static/42ecb17845b89a0f7900a2a918f4fdf9/08f6a/lec3-kernel-designs.png 1770w,\n/static/42ecb17845b89a0f7900a2a918f4fdf9/1fe1a/lec3-kernel-designs.png 2680w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<h3>Kernel modules</h3>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9b28e826c8238010a24054e6340593e/c664d/lec3-kernel-module.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 338px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 91.71597633136095%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACDElEQVQ4y4WU16qqQQyFff9H8VoUFURFBduFDRRRsffeazZfNpH59Rz2QJi+spKVGd/1epX9fv+28/nssePx+N47HA7yeDyE9nq91D6bb71ey3w+l8ViIavVSur1ujQaDWm329JqtaTX6+n6crmU6XSqDv4E5AI9LLLZrAQCAYlEIhIMBhWc9c1mo04/AT/NB1i/35fhcCiDwUBGo5GMx2PtJ5OJjtljzv7pdJL/NQW83W7Kbrfb6YVqtSrdbleazaauE6qFzPx+v2seP+35fP6G7HpgY7vdCk4wBGOOMwRBJHoz0oATM+743OQCABs2YNvpdJQZoOl0WkKhkGQyGUkkEpLL5TQa0gUwwpJfDyBABkiuAMUzgCgOSLFYVOFKpZKCzWYzL6Al0wABuFwuOgeISwAjDpcpHesRyhVTQ/4XIKHTEMAtahuTU8urzU39L0ALmeaqC0NYERpmhW4Pgh7RPICmKrkgFPJGfmCSTCbF7/dLNBrVwo/FYpJKpfQcDK3oPYDkDi806gomxoyL9hypURuzbvkk7C9A9yUwNhEwe/OumUCkABJfgKaw5dSEYJ25nfn8jewn8gByAE9csDcOC0Qpl8uSz+elUqloDfIr1Wo1DZmzMP0KGcqAUS6A2CvAOwWNGPF4XMLhsIpUKBTeokDkLYoL6jY881HwJ/LzuIXNHKOo2cc5ZH4APh9U7HfCPXIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Kernel modules\"\n        title=\"\"\n        src=\"/static/d9b28e826c8238010a24054e6340593e/c664d/lec3-kernel-module.png\"\n        srcset=\"/static/d9b28e826c8238010a24054e6340593e/090cd/lec3-kernel-module.png 148w,\n/static/d9b28e826c8238010a24054e6340593e/24e39/lec3-kernel-module.png 295w,\n/static/d9b28e826c8238010a24054e6340593e/c664d/lec3-kernel-module.png 338w\"\n        sizes=\"(max-width: 338px) 100vw, 338px\"\n      />\n  </span>\n  </a></p>\n<p>Modular kernels are type of hybrid kernels, usually consist of smaller kernel with only essential components plus non-essential, dynamically loadable kernel parts - <strong>kernel modules</strong>. Drivers are often implemented as modules.</p>\n<p>Modules are often loaded on demand, when needed or requested. It could be at boot time or later. Modules usually run in kernel mode.</p>\n<ul>\n<li>OS can come with many drivers but only those that needed are loaded which results in faster boot time</li>\n<li>No kernel recompile/reboot necessary to activate a module</li>\n</ul>\n<h3>Layered approach</h3>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8b7143b183752d1aa2e9eb187a860181/8cc2a/lec3-kernel-layers.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 224px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 186.60714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAABYlAAAWJQFJUiTwAAADeklEQVRIx6VWaU8iQRDl17tx/eoXdXch6ipfTDxI0AhEE4+YNVESrywoIAwowgynoBy19RpqbIbhWJ3k0TPNm+7q7lf1xtPtdqnRaFCtVhtAtVodCScXeH9/J1yet7c3en5+pmKxSIVCQQH3pmkqlMtlsiyLKpWKavGsc3UgOA+ie3p6UmQZBC/E43HKZrN0e3tL6XSaotEoPT4+0sXFBRmGQaVSaWBiBNXpdD4GlIEwEwY/ODigjY0NmpubI7/fT99mZigWi9Hp6SklEgl7QEE+n/+IEKNjSSABWBYGRn+Go0txZNIPCE+HHSE2M5lM0sPDwwDQB6QyGcqiBScxzEO09/f3lMvleoeCH0Sph6+Aw+Gl5zm69I8lMgI76nmI19/HVqvVGxDrHnvx/6Xfq/R6ckKTLrWH+BkFXJ3XVyr++kmVcMh+aRw8QkLI7XbbhnrmTW7xdpi83Or5ObWZi34nF5DLgwddgwJL9gstJAUOAyfq5IOHDFIDOnWo6woSARGSQnqZ3A+x4z8nH7IZyBSdgHsIGPD5fLS/v0/z8/N0fX1NgUBAtZhEuK7C1peBZV1dXdHh4SFtb29TOBSiSCRCGdbkCZ82WnD0ZWNAO/VAeHl5UZ0CzCrZUUL14dNG9uBlnSv3ELYtGzwgT6F4FAUB+v6if2+PYsfHFOfMiPOzzhFgcjtTxl0dPpTi0iJVd3e/Luxun2T616l2dtZ7ifdpXCJMjhCnyRFWdoPTR9hsNl3Leg3lvl4ni4tsictYjQ/w0xYgMlJ1Ei/xKVuaJQhPf2+kBQB3d3eq/+bmhpJc8y4vL5UVHB0dqRoo3jKVBeAeAt7a2lIWsL62Rt9nZ5W/QODwF0SuRzmUKXppBxmTICKDRW9w/sry8eJEC5AyrgN9sIBEKkVpWAI/x7WSrwPCHrIAKVkCtTc8cyFrkOHzUo5lY/Iq9PImPEQ4vQWgXq6uUJ0P478yRTr0P5WwYWCwgEh4wAKcvCELcJb0tmYB1g4s4I+ygLZL+Xe1AF1Toyyg6Cj7X7MAbi3Nl/VBp7KAM64uEPfy8jKFw2FaXFhQWeP1elUWiQW4eoqbBSAb8MG0ublJIbaAYDCoDAr98vU11gKQRijnAvkmLPe1V+eqA47ksM7FYJhswAKgdlG9tLCAWL/kO1tntgxZwKRPjEmfLK7C/uylj/EPtxDpootqi4UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Kernel layers\"\n        title=\"\"\n        src=\"/static/8b7143b183752d1aa2e9eb187a860181/8cc2a/lec3-kernel-layers.png\"\n        srcset=\"/static/8b7143b183752d1aa2e9eb187a860181/61446/lec3-kernel-layers.png 148w,\n/static/8b7143b183752d1aa2e9eb187a860181/8cc2a/lec3-kernel-layers.png 224w\"\n        sizes=\"(max-width: 224px) 100vw, 224px\"\n      />\n  </span>\n  </a></p>\n<p>Each layer only talk to layer below or above. Layer design is slow.</p>\n<h2>Virtual Machines</h2>\n<p>Virtual machines emulate computer systems either in software or in specialized hardware, or both. Host machine creates illusion that each guest machine has its own processor and its own hardware. <strong>Hypervisor</strong> - software or hardware that manages VMs. There are several types of hypervisors:</p>\n<ul>\n<li>\n<p>Bare metal - runs directly on hardware</p>\n<ul>\n<li>usually runs on big servers</li>\n<li>XEN, VMWare ESX</li>\n</ul>\n</li>\n<li>\n<p>Hosted - runs on top of another OS. Slower that bare metal, has to communicate with hardware through OS.</p>\n<ul>\n<li>Usually on desktops, slower</li>\n<li>VMWare Player, VirtualBox</li>\n</ul>\n</li>\n<li>Hybrid - using kernel itself as a hypervisor through a KVM module.</li>\n</ul>\n<p>Virtual machines can save money for companies, time for developers. VMs are isolated from each other, that means a user can run different versions of same program, or run unsafe programs. VMs are perfect solution for sys admins: there's no need to setup multiple servers, instead one big server can be setup with multiple VMs. That makes it easier to maintain.</p>\n<!--Containers do not virtualize the machine, containers virtualize the OS. \"each user app has it's own os\"-->","frontmatter":{"title":"Interrupts, traps, kernel design, VMs","date":"2019-01-22","description":""},"fields":{"slug":"/cpsc457/lec3-interrupts-traps-kernels-vms","category":"cpsc457"}}},{"node":{"id":"dfff0736-3c0b-51c2-8d28-2810c0ee4dd7","html":"<h2>Hardware Review</h2>\n<p>A typical computer contains of several components that are interconnected through a bus.</p>\n<h3>CPU</h3>\n<p>CPU is the \"brain\" of the computer. It contains different types of registers (registers - very fast memory):</p>\n<ul>\n<li>\n<p>On-board registers for faster computation.</p>\n<ul>\n<li>Instead of accessing memory for every instruction</li>\n<li>Accessing information in registers is faster than memory</li>\n</ul>\n</li>\n<li>\n<p>General purpose registers</p>\n<ul>\n<li>Data &#x26; address</li>\n</ul>\n</li>\n</ul>\n<!--TODO: Finish-->\n<p>A simple CPU cycle:</p>\n<ol>\n<li><strong>Fetch</strong> an instruction</li>\n<li><strong>Decode</strong> it to determine its type and operands</li>\n<li><strong>Execute</strong> it</li>\n</ol>\n<p>Steps are repeated for the next instruction, until program finishes.</p>\n<p>However, there is a performance issue: fetching from memory takes longer than executing an instruction. A solution would be to <strong>pipeline</strong> the opertaions:</p>\n<h4>CPU Pipelining</h4>\n<ul>\n<li>while executing instruction <code class=\"language-text\">N</code>,</li>\n<li>the CPU could be simultaneously decoding instruction <code class=\"language-text\">N + 1</code>,</li>\n<li>and at the same time also fetch instruction <code class=\"language-text\">N + 2</code></li>\n</ul>\n<p>Therefore fetch-execute cycle can be done in parallel. Parallelized app will be as fast as slowest link of the pipeline. Three stage pipeline:</p>\n<div class=\"gatsby-highlight\" data-language=\"mermaid-svg\"><pre class=\"language-mermaid-svg\"><code class=\"language-mermaid-svg\">graph LR\n  A[Fetch Unit]--&gt;B[Decode Unit]\n  B--&gt;C[Execute Unit]</code></pre></div>\n<p>Pros:</p>\n<ul>\n<li>the CPU can execute more than one instruction at a time</li>\n<li>'hide' the memory access time</li>\n</ul>\n<p>Cons:</p>\n<ul>\n<li>more complexity</li>\n</ul>\n<h3>Memory</h3>\n<p>Ideally, memory should be (i) fast, (ii) large and (iii) cheap. In practice, we can get 2 out of 3, but not all three.</p>\n<p>Main memory is RAM (Random Access Memory). Memory is a accessible big array of bytes. Memory operations:</p>\n<ul>\n<li><strong>load</strong>: moves a word from memory to a CPU register</li>\n<li><strong>store</strong>: moves a content of a register to memory</li>\n</ul>\n<p>Both load and store operations are slow compared to the speed of CPU.</p>\n<h2>Caching</h2>\n<p>CPU caching is the process of most heavily used data from memory is kept in a high-speed cache inside or very close to the CPU. When CPU needs to get data from memory, it first checks the cache:</p>\n<ul>\n<li>\n<p><strong>cache hit</strong>: the data needed by the CPU is in the cache</p>\n  <!--or-->\n</li>\n<li><strong>cache miss</strong>: CPU needs to fetch the data from main memory</li>\n</ul>\n<p>CPU consists of multiple levels of caches:</p>\n<ul>\n<li>L1 cache (16kB): inside the CPU, usually feeds decoded instructions into CPU execution engine</li>\n<li>L2 cache (xMB): stores recently used memory words, slower than L1</li>\n<li>L3 and L4 are becoming common</li>\n</ul>\n<!--core is like a mini cpu-->\n<h3>Caching on multicore CPUs</h3>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d3db85953807fa906d525e8102cdec6/79964/lec2-caching1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.06611570247933%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACTklEQVQoz0WSX2vTUBjG9x0EP4F3foSBn8KhTK8G3rgbvfLCSy8cc45dDhQGIkMmCOIfnJSNucm2dl3pX9suSZOepEnTpE33B9uuzc+TZMND3veccB6e877P804hVyBU3C8fafstLEfB+7yBYyr45350TTiZxHu/qeK9f4tTL2Ne+Ljb3/E/fcDybbx+J8ZMhTKZ5TSNlWV0o0GlkcF4vYSSz2F4OmEoya4IW+kd3Nl79A72sAkwll/gzc8TnHYwXVViQ6ZkxuzJys66+J6F7pVx/wZYtqDpNggJScoMsQMH0evy47dKKlvDOrWpCpeNzSp5VY1AskKJt7oaqcwu3zLHpIo5vu4fsl04oNlV4ldjUvmZnpCt2cytVLj/6hDvVKOgOdx+nObdVilpeTIGf2DwYLXAzYfHTD8rceNRjadrafyLOuMxMWm0zHadP/lNylKWcrtE/WSPWnGLvJlDaVcTwihZeoHM+iqZeo6cekR2/Q2Z/C8MWXlc4ZWG9u5Punem6e/tIDhHPH9Cf2aG7lkP0VbjTmJTWsU09tIijm2iNrO4iy+lUSWELxJTwlgeHN9CaCrFokJN6IiWglZVKFR0GrZ+rWEotTI58V00Q6PSKqAGPoquoTtXGoaJhqLTpCNJZxfy3F04kHqqHFdNbs3ts5Yq/m85kPPmeAbtoEWr15TzKHB6pmwlma1rp/sXPeyuIKs2OVJ1iRfSKIudsobhugnhaDRiOBgmMYzOMoZDBoOBjGSfSA3H0p3oHOGYXMJ4FN9HWCYjLkfD+P8f3PTSSGXsKawAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Caching on multicore CPUs\"\n        title=\"\"\n        src=\"/static/4d3db85953807fa906d525e8102cdec6/fb8a0/lec2-caching1.png\"\n        srcset=\"/static/4d3db85953807fa906d525e8102cdec6/1a291/lec2-caching1.png 148w,\n/static/4d3db85953807fa906d525e8102cdec6/2bc4a/lec2-caching1.png 295w,\n/static/4d3db85953807fa906d525e8102cdec6/fb8a0/lec2-caching1.png 590w,\n/static/4d3db85953807fa906d525e8102cdec6/526de/lec2-caching1.png 885w,\n/static/4d3db85953807fa906d525e8102cdec6/fa2eb/lec2-caching1.png 1180w,\n/static/4d3db85953807fa906d525e8102cdec6/08f6a/lec2-caching1.png 1770w,\n/static/4d3db85953807fa906d525e8102cdec6/79964/lec2-caching1.png 2178w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<!--1. can process bigger chunks, bigger parts of the memory because L2 will be bigger-->\n<p>Caches can be shared and there are multiple ways of sharing cache.</p>\n<hr>\n<p>The goal of caching is to increase performance of slower memory/device by adding a small amount of fast memory (cache). Ways of improving read performance:</p>\n<ul>\n<li>keep copy of information obtained from slow storage in cache</li>\n<li>check cache on next read</li>\n</ul>\n<p>Improving write performance:</p>\n<ul>\n<li>write info to fast storage, and eventually write to slow storage</li>\n</ul>\n<p>Caching is a very useful concept. There are many uses: disk cache, DNS, databases.</p>\n<p>Cache storage is fast but expensive, so it's usually much smaller than the slow storage. Some general caching issues:</p>\n<ul>\n<li>when to put a new item into the cache</li>\n<li>which cache line to put the new item in</li>\n<li>which item to remove from the cache when it's full</li>\n<li>where to put a newly evicted item in the larger memory</li>\n<li>multiple cache synchronization</li>\n<li>how long is the data in cache valid</li>\n</ul>\n<h3>Memoization</h3>\n<p>It's a similar concept to caching. It can be used to speed up function that are slow to compute. Optimization technique used to speed up programs, by storing results of expensive computations.</p>\n<p>Unoptimized function:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">fib_slow</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> n\n  <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> fib_slow<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fib_slow<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Optimized function:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cache <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">fib_fast</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> n <span class=\"token operator\">not</span> <span class=\"token keyword\">in</span> cache<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n      cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> n\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n      cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> fib_fast<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fib_fast<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Hardware I/O</h2>\n<p>I/O devices usually implemented in two parts: device controller and the device.</p>\n<p>A <strong>device controller</strong> is a chip or a set of chips that physically control the device. Controlling the device is complicated, and CPU could be doing other things, so the controller presents a simpler interface to the OS. A controller presents a unified interface of devices that it can support to the OS.</p>\n<p>A <strong>device</strong> connects to the computer through the controller. It follows some agreed standards for communication.</p>\n<p>A <strong>device driver</strong> is the software abstraction of the controller, the software that talks to a controller, issues commands and accepts responses. Usually is written by the manufacturer. Driver is needed so the OS knows how to communicate with the device.</p>\n<h2>Buses</h2>\n<p><strong>Bus</strong> is a communication system for transferring data between different computer components.</p>\n<h2>Booting Process</h2>\n<p>When the computer is booted, the BIOS is started. BIOS (Basic Input Output Program) is a program stored on motherboard.</p>\n<h2>Kernel</h2>\n<p>The central part, or the heart of the OS. Kernel is running at all times on the computer. It is located and started by a bootstrap program (bootloader). Kernel provides services to applications via system calls and handles all interrupts. Much of kernel is a set of routines, some invoked in response to interrupts, others because of application using system calls, etc.</p>\n<h3>Kernel mode</h3>\n<p>Most modern CPUs support at least two privilege levels: <strong>kernel mode</strong> and <strong>user mode</strong>. The mode is usually controlled by modifying the status register. On CPUs without this support, there's only kernel mode.</p>\n<p>When CPU is in <strong>kernel mode</strong>:</p>\n<ul>\n<li>all instructions are allowed</li>\n<li>all I/O operations are allowed</li>\n<li>all memory can be accessed</li>\n</ul>\n<!--not all kernel runs in kernel mode-->\n<p>When CPU is in kernel mode, every instruction are executed.</p>\n<h3>User mode</h3>\n<p>When OS runs a normal application, it runs it in a <strong>user mode</strong>. Only a subset of operations are allowed (e.g. accessing the status register is not allowed). I/O instructions are not allowed, access to some parts of memory is not allowed. Illegal instructions result in traps (exceptions).</p>\n<p>Applications that run in user mode must ask kernel to do I/O. Therefore, applications must invoke a <strong>system call</strong>, which is usually accomplished by invoking a <strong>trap</strong> into the OS.</p>\n<h4>Trap</h4>\n<p>Trap is a special asm instruction (<code class=\"language-text\">SWI n</code>, <code class=\"language-text\">INT n</code>, <code class=\"language-text\">TRAP n</code>). Trap switches from user mode to kernel mode and invokes a <strong>predefined routine</strong>. It 'pauses' the application to execute kernel routine configured by the OS. When kernel routine is done, user mode is restored and application 'resumes'.</p>\n<hr>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8d89be046658dcbe0acd354f8bfd4e04/754de/lec2-kernel-user-mode.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.998240985048376%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMElEQVQoz3VSh4qEMBD1//9OBJW1xAaWGPuJfc43Rw6Xuw0Ew2Ty2mhM00RSSsK3bVtSSvG5rmtqmobO86TruniP48i1ZVkIS9efyyjLkkzTZNDX60WWZTGY4zgUhiEdx/ELmuc5+b7PwE/A5za2baNhGLhhXVfq+57P+OIOTRoQyqD+ExgDQo3rumxFCMGqYBs1KAJZ13VMEAQBRVFE8zz/sfpmGTaSJCHP8/hBmqYUx/HbF/kCFMQgAakQIWVZdtcUqVreDhcydBMakKMeDBqLouAz7kGs736Go243/k0W35lLzpota+/7vvMDPIYiDAVDwhk1RKMfIVMQIB6orKryjuGL64b2jkZkgw11mDxyhEpdfy4ojETACqWsGBCExn//EtTYts0bqp+kn4ah1zdeUK/0/+Z77gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Kernel mode vs User mode\"\n        title=\"\"\n        src=\"/static/8d89be046658dcbe0acd354f8bfd4e04/fb8a0/lec2-kernel-user-mode.png\"\n        srcset=\"/static/8d89be046658dcbe0acd354f8bfd4e04/1a291/lec2-kernel-user-mode.png 148w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/2bc4a/lec2-kernel-user-mode.png 295w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/fb8a0/lec2-kernel-user-mode.png 590w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/526de/lec2-kernel-user-mode.png 885w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/fa2eb/lec2-kernel-user-mode.png 1180w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/08f6a/lec2-kernel-user-mode.png 1770w,\n/static/8d89be046658dcbe0acd354f8bfd4e04/754de/lec2-kernel-user-mode.png 2274w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<!--true-->\n<!--true-->\n<!--most run in kernel, but some are in user mode-->","frontmatter":{"title":"Hardware, Cache, Booting, Kernel","date":"2019-01-17","description":""},"fields":{"slug":"/cpsc457/lec2-hardware-cache","category":"cpsc457"}}},{"node":{"id":"25b45286-48c7-592a-be74-3f2f739da7ed","html":"<h2>Defining an OS</h2>\n<p>There's no 'precise' definition. It is a layer of software that provides application programs with a better, simpler, cleaner model of the computer. The OS is there to simplify interaction with the hardware. OS manages all resources.</p>\n<p>It is the software that runs all the time (mostly in kernel mode). All other applications need it in order to run (<em>most</em> applications will need it).</p>\n<p>We can look at an OS from two different perspectives:</p>\n<ul>\n<li>an <strong>extended machine</strong></li>\n<li>as a <strong>resource manager</strong></li>\n</ul>\n<p>An OS presents an abstraction mechanism that lets you interact with the hardware.</p>\n<h3>OS - an extended machine</h3>\n<p>Abstraction / generalization is key to managing complexity. First we define and implement the abstractions. For example, files - working with files is easier than dealing with raw disk space. Then, using these abstractions, we write applications and solve problems (e.g. file editor, image viewer). An OS doesn't care what's in the file, it is up to the applications to determine how to use the file.</p>\n<p>The abstractions allow us to mask the ugly hardware and provide nice interfaces instead. Many OS concepts are abstractions, therefore there are some similarities to OOP.</p>\n<h3>OS - a resource manager</h3>\n<p>OS acts as a resource allocator. It multiplexes available resources.</p>\n<ul>\n<li>\n<p>Multiplexing resources in time</p>\n<ul>\n<li>e.g. 3 programs trying to print to the same printer (spooling)</li>\n<li>e.g. 2 programs trying to run at the same time (scheduling)</li>\n</ul>\n</li>\n<li>\n<p>Multiplexing resources in space</p>\n<ul>\n<li>e.g. 2 programs allocating memory</li>\n</ul>\n</li>\n</ul>\n<p>OS manages conflics among multiple programs or users.</p>\n<!--IMPORTANT: syscalls need to be checked-->\n<p>We can also think about OS as a control program. It decides when to run which application. OS monitors improper use and prevents errors. OS is responsible for handling all interrupts and traps.</p>\n<h2>History of Operating Systems</h2>\n<p>OSes often developed by customers instead of HW manufacturers. IBM developed first OS in the 60's.</p>\n<h3>First Generation (1945 - 1955): Vacuum Tubes and no OS</h3>\n<p>Programs were hardwired, later were made on punch cards. Programs were written in machine language. Hardware required complicated wiring. Only single user at a time. Such computers were only able to perform basic calculations. No OS since there was no need for one.</p>\n<h3>Second Generation (1955 - 1965): Transistors and Batch Systems</h3>\n<p>Transistor based mainframe computers replaced old vacuum tube computers. Programs were made with FORTRAN &#x26; COBOL. OSes that were used: FMS (Fortran Monitor System) and IBSYS (IBM OS). Important concept was introduced: <strong>batch systems</strong>.</p>\n<h4>Batch Systems</h4>\n<p>The users of a batch operating system do not interact with the computer directly. Each user prepares his job on an off-line device like punch cards and submits it to the computer operator. To speed up processing, jobs with similar needs are batched together and run as a group. The programmers leave their programs with the operator and the operator then sorts the programs with similar requirements into batches.</p>\n<h3>Third Generation (1965 - 1980): ICs and Multiprogramming</h3>\n<p>Transistors were replaces with Integrated Circuits (ICs). Lots of OSes came out: IBM OS/360, CTSS (by MIT), MULTICS (complicated, but influential), UNIX (inspired by MULTICS). Important concepts:</p>\n<ul>\n<li><strong>multiprogramming</strong>: a different job in each memory partition, CPU execute other jobs, while waiting for the IO of some jobs. Multiple programs could sit in memory.</li>\n<li><strong>spooling</strong> (Simultaneous Peripheral Operation On Line): read jobs from cards to disk, load jobs from disk automatically, no more tapes.</li>\n<li><strong>time-sharing</strong>: multiple users using one computer simultaneously and interactively. Terminals were connected to a central server.</li>\n</ul>\n<h4>Multiprogramming</h4>\n<p>Refers to the idea, if you have more than one program in the memory, processor will switch between the programs when one program is idle.</p>\n<h4>Spooling</h4>\n<p>Spooling is typically used to deal with slow devices/peripherals, e.g. printer. Spooling can be used to deal (somewhat) with deadlocks in concurrent programming.</p>\n<h3>Fourth Generation (1990 - Now): Personal Computers</h3>\n<p>Cheap, mass-produced computers, User friendly interfaces on top of OS.</p>","frontmatter":{"title":"Operating Systems: Introduction, History, Basic Concepts","date":"2019-01-15","description":""},"fields":{"slug":"/cpsc457/lec1-basic-concepts","category":"cpsc457"}}}]}},"pageContext":{"tag":"cpsc457"}}