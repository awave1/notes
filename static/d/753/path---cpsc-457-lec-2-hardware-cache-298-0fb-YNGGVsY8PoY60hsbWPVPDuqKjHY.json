{"data":{"markdownRemark":{"html":"<h2>Hardware Review</h2>\n<p>A typical computer contains of several components that are interconnected through a bus.</p>\n<h3>CPU</h3>\n<p>CPU is the \"brain\" of the computer. It contains different types of registers (registers - very fast memory):</p>\n<ul>\n<li>\n<p>On-board registers for faster computation.</p>\n<ul>\n<li>Instead of accessing memory for every instruction</li>\n<li>Accessing information in registers is faster than memory</li>\n</ul>\n</li>\n<li>\n<p>General purpose registers</p>\n<ul>\n<li>Data &#x26; address</li>\n</ul>\n</li>\n</ul>\n<!--TODO: Finish-->\n<p>A simple CPU cycle:</p>\n<ol>\n<li><strong>Fetch</strong> an instruction</li>\n<li><strong>Decode</strong> it to determine its type and operands</li>\n<li><strong>Execute</strong> it</li>\n</ol>\n<p>Steps are repeated for the next instruction, until program finishes.</p>\n<p>However, there is a performance issue: fetching from memory takes longer than executing an instruction. A solution would be to <strong>pipeline</strong> the opertaions:</p>\n<h4>CPU Pipelining</h4>\n<ul>\n<li>while executing instruction <code class=\"language-text\">N</code>,</li>\n<li>the CPU could be simultaneously decoding instruction <code class=\"language-text\">N + 1</code>,</li>\n<li>and at the same time also fetch instruction <code class=\"language-text\">N + 2</code></li>\n</ul>\n<p>Therefore fetch-execute cycle can be done in parallel. Three stage pipeline:</p>\n<div class=\"remark-draw remark-draw-mermaid\"><svg id=\"mermaid-1548047655248\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" style=\"max-width: 430.40625px;\" viewBox=\"0 0 430.40625 55\"><style>#mermaid-1548047655248 .label{font-family:trebuchet ms,verdana,arial;color:#333}#mermaid-1548047655248 .node circle,#mermaid-1548047655248 .node ellipse,#mermaid-1548047655248 .node polygon,#mermaid-1548047655248 .node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}#mermaid-1548047655248 .node.clickable{cursor:pointer}#mermaid-1548047655248 .arrowheadPath{fill:green}#mermaid-1548047655248 .edgePath .path{stroke:green;stroke-width:1.5px}#mermaid-1548047655248 .edgeLabel{background-color:#e8e8e8}#mermaid-1548047655248 .cluster rect{fill:#cdffb2!important;stroke:#6eaa49!important;stroke-width:1px!important}#mermaid-1548047655248 .cluster text{fill:#333}#mermaid-1548047655248 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:trebuchet ms,verdana,arial;font-size:12px;background:#cdffb2;border:1px solid #6eaa49;border-radius:2px;pointer-events:none;z-index:100}#mermaid-1548047655248 .actor{stroke:#13540c;fill:#cde498}#mermaid-1548047655248 text.actor{fill:#000;stroke:none}#mermaid-1548047655248 .actor-line{stroke:grey}#mermaid-1548047655248 .messageLine0{marker-end:\"url(#arrowhead)\"}#mermaid-1548047655248 .messageLine0,#mermaid-1548047655248 .messageLine1{stroke-width:1.5;stroke-dasharray:\"2 2\";stroke:#333}#mermaid-1548047655248 #arrowhead{fill:#333}#mermaid-1548047655248 #crosshead path{fill:#333!important;stroke:#333!important}#mermaid-1548047655248 .messageText{fill:#333;stroke:none}#mermaid-1548047655248 .labelBox{stroke:#326932;fill:#cde498}#mermaid-1548047655248 .labelText,#mermaid-1548047655248 .loopText{fill:#000;stroke:none}#mermaid-1548047655248 .loopLine{stroke-width:2;stroke-dasharray:\"2 2\";marker-end:\"url(#arrowhead)\";stroke:#326932}#mermaid-1548047655248 .note{stroke:#6eaa49;fill:#fff5ad}#mermaid-1548047655248 .noteText{fill:#000;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:14px}#mermaid-1548047655248 .section{stroke:none;opacity:.2}#mermaid-1548047655248 .section0,#mermaid-1548047655248 .section2{fill:#6eaa49}#mermaid-1548047655248 .section1,#mermaid-1548047655248 .section3{fill:#fff;opacity:.2}#mermaid-1548047655248 .sectionTitle0,#mermaid-1548047655248 .sectionTitle1,#mermaid-1548047655248 .sectionTitle2,#mermaid-1548047655248 .sectionTitle3{fill:#333}#mermaid-1548047655248 .sectionTitle{text-anchor:start;font-size:11px;text-height:14px}#mermaid-1548047655248 .grid .tick{stroke:#d3d3d3;opacity:.3;shape-rendering:crispEdges}#mermaid-1548047655248 .grid path{stroke-width:0}#mermaid-1548047655248 .today{fill:none;stroke:red;stroke-width:2px}#mermaid-1548047655248 .task{stroke-width:2}#mermaid-1548047655248 .taskText{text-anchor:middle;font-size:11px}#mermaid-1548047655248 .taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}#mermaid-1548047655248 .taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}#mermaid-1548047655248 .taskText0,#mermaid-1548047655248 .taskText1,#mermaid-1548047655248 .taskText2,#mermaid-1548047655248 .taskText3{fill:#fff}#mermaid-1548047655248 .task0,#mermaid-1548047655248 .task1,#mermaid-1548047655248 .task2,#mermaid-1548047655248 .task3{fill:#487e3a;stroke:#13540c}#mermaid-1548047655248 .taskTextOutside0,#mermaid-1548047655248 .taskTextOutside1,#mermaid-1548047655248 .taskTextOutside2,#mermaid-1548047655248 .taskTextOutside3{fill:#000}#mermaid-1548047655248 .active0,#mermaid-1548047655248 .active1,#mermaid-1548047655248 .active2,#mermaid-1548047655248 .active3{fill:#cde498;stroke:#13540c}#mermaid-1548047655248 .activeText0,#mermaid-1548047655248 .activeText1,#mermaid-1548047655248 .activeText2,#mermaid-1548047655248 .activeText3{fill:#000!important}#mermaid-1548047655248 .done0,#mermaid-1548047655248 .done1,#mermaid-1548047655248 .done2,#mermaid-1548047655248 .done3{stroke:grey;fill:#d3d3d3;stroke-width:2}#mermaid-1548047655248 .doneText0,#mermaid-1548047655248 .doneText1,#mermaid-1548047655248 .doneText2,#mermaid-1548047655248 .doneText3{fill:#000!important}#mermaid-1548047655248 .crit0,#mermaid-1548047655248 .crit1,#mermaid-1548047655248 .crit2,#mermaid-1548047655248 .crit3{stroke:#f88;fill:red;stroke-width:2}#mermaid-1548047655248 .activeCrit0,#mermaid-1548047655248 .activeCrit1,#mermaid-1548047655248 .activeCrit2,#mermaid-1548047655248 .activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}#mermaid-1548047655248 .doneCrit0,#mermaid-1548047655248 .doneCrit1,#mermaid-1548047655248 .doneCrit2,#mermaid-1548047655248 .doneCrit3{stroke:#f88;fill:#d3d3d3;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}#mermaid-1548047655248 .activeCritText0,#mermaid-1548047655248 .activeCritText1,#mermaid-1548047655248 .activeCritText2,#mermaid-1548047655248 .activeCritText3,#mermaid-1548047655248 .doneCritText0,#mermaid-1548047655248 .doneCritText1,#mermaid-1548047655248 .doneCritText2,#mermaid-1548047655248 .doneCritText3{fill:#000!important}#mermaid-1548047655248 .titleText{text-anchor:middle;font-size:18px;fill:#000}#mermaid-1548047655248 g.classGroup text{fill:#13540c;stroke:none;font-family:trebuchet ms,verdana,arial;font-size:10px}#mermaid-1548047655248 g.classGroup rect{fill:#cde498;stroke:#13540c}#mermaid-1548047655248 g.classGroup line{stroke:#13540c;stroke-width:1}#mermaid-1548047655248 .classLabel .box{stroke:none;stroke-width:0;fill:#cde498;opacity:.5}#mermaid-1548047655248 .classLabel .label{fill:#13540c;font-size:10px}#mermaid-1548047655248 .relation{stroke:#13540c;stroke-width:1;fill:none}#mermaid-1548047655248 #compositionEnd,#mermaid-1548047655248 #compositionStart{fill:#13540c;stroke:#13540c;stroke-width:1}#mermaid-1548047655248 #aggregationEnd,#mermaid-1548047655248 #aggregationStart{fill:#cde498;stroke:#13540c;stroke-width:1}#mermaid-1548047655248 #dependencyEnd,#mermaid-1548047655248 #dependencyStart,#mermaid-1548047655248 #extensionEnd,#mermaid-1548047655248 #extensionStart{fill:#13540c;stroke:#13540c;stroke-width:1}#mermaid-1548047655248 .branch-label,#mermaid-1548047655248 .commit-id,#mermaid-1548047655248 .commit-msg{fill:#d3d3d3;color:#d3d3d3}</style><style>#mermaid-1548047655248 {\n    color: rgb(0, 0, 0);\n    font: normal normal 400 normal 16px / normal \"Times New Roman\";\n  }</style><g transform=\"translate(-12, -12)\"><g class=\"output\"><g class=\"clusters\"></g><g class=\"edgePaths\"><g class=\"edgePath\" style=\"opacity: 1;\"><path class=\"path\" d=\"M114.984375,39.5L139.984375,39.5L164.984375,39.5\" marker-end=\"url(#arrowhead12)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead12\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g><g class=\"edgePath\" style=\"opacity: 1;\"><path class=\"path\" d=\"M272.515625,39.5L297.515625,39.5L322.515625,39.5\" marker-end=\"url(#arrowhead13)\" style=\"fill:none\"></path><defs><marker id=\"arrowhead13\" viewBox=\"0 0 10 10\" refX=\"9\" refY=\"5\" markerUnits=\"strokeWidth\" markerWidth=\"8\" markerHeight=\"6\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\" class=\"arrowheadPath\" style=\"stroke-width: 1; stroke-dasharray: 1, 0;\"></path></marker></defs></g></g><g class=\"edgeLabels\"><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\" transform=\"\" style=\"opacity: 1;\"><g transform=\"translate(0,0)\" class=\"label\"><foreignObject width=\"0\" height=\"0\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g class=\"node\" id=\"A\" transform=\"translate(67.4921875,39.5)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-47.4921875\" y=\"-19.5\" width=\"94.984375\" height=\"39\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-37.4921875,-9.5)\"><foreignObject width=\"74.984375\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Fetch Unit</div></foreignObject></g></g></g><g class=\"node\" id=\"B\" transform=\"translate(218.75,39.5)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-53.765625\" y=\"-19.5\" width=\"107.53125\" height=\"39\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-43.765625,-9.5)\"><foreignObject width=\"87.53125\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Decode Unit</div></foreignObject></g></g></g><g class=\"node\" id=\"C\" transform=\"translate(378.4609375,39.5)\" style=\"opacity: 1;\"><rect rx=\"0\" ry=\"0\" x=\"-55.9453125\" y=\"-19.5\" width=\"111.890625\" height=\"39\"></rect><g class=\"label\" transform=\"translate(0,0)\"><g transform=\"translate(-45.9453125,-9.5)\"><foreignObject width=\"91.890625\" height=\"19\"><div xmlns=\"http://www.w3.org/1999/xhtml\" style=\"display: inline-block; white-space: nowrap;\">Execute Unit</div></foreignObject></g></g></g></g></g></g></svg></div>\n<p>Pros:</p>\n<ul>\n<li>the CPU can execute more than one instruction at a time</li>\n<li>'hide' the memory access time</li>\n</ul>\n<p>Cons:</p>\n<ul>\n<li>more complexity</li>\n</ul>\n<p>Parallelized app will be as fast as slowest link of the pipeline.</p>\n<h3>Memory</h3>\n<p>Ideally, memory should be (i) fast, (ii) large and (iii) cheap. In practice, we can get 2 out of 3, but not all three.</p>\n<p>Main memory is RAM (Random Access Memory). Memory is a accessible big array of bytes. Memory operations:</p>\n<ul>\n<li><strong>load</strong>: moves a word from memory to a CPU register</li>\n<li><strong>store</strong>: moves a content of a register to memory</li>\n</ul>\n<p>Both load and store operations are slow compared to the speed of CPU.</p>\n<h2>Caching</h2>\n<p>CPU caching is the process of most heavily used data from memory is kept in a high-speed cache inside or very close to the CPU. When CPU needs to get data from memory, it first checks the cache:</p>\n<ul>\n<li>\n<p><strong>cache hit</strong>: the data needed by the CPU is in the cache</p>\n  <!--or-->\n</li>\n<li><strong>cache miss</strong>: CPU needs to fetch the data from main memory</li>\n</ul>\n<p>CPU consists of multiple levels of caches:</p>\n<ul>\n<li>L1 cache (16kB): inside the CPU, usually feeds decoded instructions into CPU execution engine</li>\n<li>L2 cache (xMB): stores recently used memory words, slower than L1</li>\n<li>L3 and L4 are becoming common</li>\n</ul>\n<!--core is like a mini cpu-->\n<h3>Caching on multicore CPUs</h3>\n<!-- TODO: image -->\n<!--1. can process bigger chunks, bigger parts of the memory because L2 will be bigger-->\n<p>Caches can be shared and there are multiple ways of sharing cache.</p>\n<hr>\n<p>The goal of caching is to increase performance of slower memory/device by adding a small amount of fast memory (cache). Ways of improving read performance:</p>\n<ul>\n<li>keep copy of information obtained from slow storage in cache</li>\n<li>check cache on next read</li>\n</ul>\n<p>Improving write performance:</p>\n<ul>\n<li>write info to fast storage, and eventually write to slow storage</li>\n</ul>\n<p>Caching is a very useful concept. There are many uses: disk cache, DNS, databases.</p>\n<p>Cache storage is fast but expensive, so it's usually much smaller than the slow storage. Some general caching issues:</p>\n<ul>\n<li>when to put a new item into the cache</li>\n<li>which cache line to put the new item in</li>\n<li>which item to remove from the cache when it's full</li>\n<li>where to put a newly evicted item in the larger memory</li>\n<li>multiple cache synchronization</li>\n<li>how long is the data in cache valid</li>\n</ul>\n<h3>Memoization</h3>\n<p>It's a similar concept to caching. It can be used to speed up function that are slow to compute. Optimization technique used to speed up programs, by storing results of expensive computations.</p>\n<p>Unoptimized function:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">fib_slow</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> n\n  <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> fib_slow<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fib_slow<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Optimized function:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">cache <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">fib_fast</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">if</span> n <span class=\"token operator\">not</span> <span class=\"token keyword\">in</span> cache<span class=\"token punctuation\">.</span>keys<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">if</span> n <span class=\"token operator\">&lt;</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\n      cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> n\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n      cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> fib_fast<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> fib_fast<span class=\"token punctuation\">(</span>n <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> cache<span class=\"token punctuation\">[</span>n<span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Hardware I/O</h2>\n<p>I/O devices usually implemented in two parts: device controller and the device.</p>\n<p>A <strong>device controller</strong> is a chip or a set of chips that physically control the device. Controlling the device is complicated, and CPU could be doing other things, so the controller presents a simpler interface to the OS. A controller presents a unified interface of devices that it can support to the OS.</p>\n<p>A <strong>device</strong> connects to the computer through the controller. It follows some agreed standards for communication.</p>\n<p>A <strong>device driver</strong> is the software abstraction of the controller, the software that talks to a controller, issues commands and accepts responses. Usually is written by the manufacturer. Driver is needed so the OS knows how to communicate with the device.</p>\n<h2>Buses</h2>\n<p><strong>Bus</strong> is a communication system for transferring data between different computer components.</p>\n<h2>Booting Process</h2>\n<p>When the computer is booted, the BIOS is started. BIOS (Basic Input Output Program) is a program stored on motherboard.</p>\n<h2>Kernel</h2>\n<p>The central part, or the heart of the OS. Kernel is running at all times on the computer. It is located and started by a bootstrap program (bootloader). Kernel provides services to applications via system calls and handles all interrupts. Much of kernel is a set of routines, some invoked in response to interrupts, others because of application using system calls, etc.</p>\n<h3>Kernel mode</h3>\n<!--not all kernel runs in kernel mode-->\n<p>When CPU is in kernel mode, every instruction are executed.</p>\n<h3>User mode</h3>\n<!--true-->\n<!--true-->\n<!--most run in kernel, but some are in user mode-->","frontmatter":{"date":"January 17, 2019","title":"Hardware, Cache, Booting, Kernel","tags":["cpsc457"]}}},"pageContext":{"prev":{"fields":{"slug":"/cpsc457/lec1-basic-concepts"},"frontmatter":{"published":true,"tags":["cpsc457"]}},"slug":"/cpsc457/lec2-hardware-cache","next":null,"category":"cpsc457"}}